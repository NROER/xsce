# the defaults on this image are user:manager, password:schooltool
- name: Get the schooltool container if it is missing
  docker: image=replaceafill/schooltool
          ports=7080:7080

- name: Configure schooltool to run in docker container under systemd
  template: backup=yes
            src={{ item.src }}
            dest={{ item.dest }}
            owner=root
            group=root
            mode={{ item.mode }}
  with_items:
      dest: '/etc/systemd/system/schooltool.service'
      mode: '0644'

- name: Enable schooltool
  service: state=started
           enabled=yes
  when: schooltool_enabled

- name: Disable schooltool
  service: state=stopped
           enabled=no
  when: not schooltool_enabled

- name: add schooltool to service list
  ini_file: dest='{{ service_filelist }}'
            section=schooltool
            option='{{ item.option }}'
            value='{{ item.value }}'
  with_items:
    - option: name
      value: Schooltool
    - option: description
      value: '"SchoolTool is an open source, web based student information system designed for schools in the developing world, with strong support for translation, localization and automated deployment and updates."'
    - option: enabled
      value: "{{ schooltool_enabled }}"
