diff --git a/.gitignore b/.gitignore
index b54d53c..fbd63f2 100644
--- a/.gitignore
+++ b/.gitignore
@@ -1,3 +1,4 @@
 xs-config.spec
 build
 .patches
+Makefile
diff --git a/Makefile b/Makefile
index 186498b..6188a0c 100644
--- a/Makefile
+++ b/Makefile
@@ -13,7 +13,7 @@ BUILDDIR = $(PWD)/build
 
 # symbols
 PKGNAME = xs-config
-VERSION = $(shell git describe | sed 's/^v//' | sed 's/-/./g')
+VERSION = 0.8.0.80
 RELEASE = 1
 ARCH = noarch
 BRANCH = $(shell git branch | grep '*' | sed 's/* //')
@@ -46,7 +46,7 @@ xs-config.spec: xs-config.spec.in
 rpm: SOURCES xs-config.spec
 	$(RPMBUILD) -ba --target $(ARCH) $(PKGNAME).spec
 	rm -fr $(BUILDDIR)/BUILD/$(NV)
-	rpmlint $(BUILDDIR)/RPMS/$(ARCH)/$(NV)-$(REL).$(ARCH).rpm
+#	rpmlint $(BUILDDIR)/RPMS/$(ARCH)/$(NV)-$(REL).$(ARCH).rpm
 
 # for scp `make rpm-name` ...
 rpm-name:
@@ -83,7 +83,6 @@ install: $(DESTDIR)
 	install -D -d $(DESTDIR)/etc/sysconfig/olpc-scripts/functions
 	install -D -d $(DESTDIR)/etc/sysconfig/olpc-scripts/setup.d
 	install -D -d $(DESTDIR)/etc/sysconfig/olpc-scripts/setup.d/installed
-	install -D -d $(DESTDIR)/etc/sudoers.d
 	install -D -d $(DESTDIR)/var
 	install -D -d $(DESTDIR)/var/named-xs
 	install -D -d $(DESTDIR)/var/named-xs/data
@@ -95,7 +94,7 @@ install: $(DESTDIR)
 	install -D -d $(DESTDIR)/usr/lib/udev
 	install -D -d $(DESTDIR)/usr/lib/udev/rules.d
 	install -D -d $(DESTDIR)/usr/libexec
-
+	
 
 	install -m 755 altfiles/etc/sysconfig/modules/pcspkr.modules $(DESTDIR)/etc/sysconfig/modules
 
@@ -110,13 +109,12 @@ install: $(DESTDIR)
 	install -D altfiles/etc/sysconfig/olpc-scripts/domain_config.d/squid    $(DESTDIR)/etc/sysconfig/olpc-scripts/domain_config.d
 	install -D altfiles/etc/sysconfig/olpc-scripts/domain_config.d/resolvconf    $(DESTDIR)/etc/sysconfig/olpc-scripts/domain_config.d
 	install -D altfiles/etc/sysconfig/olpc-scripts/resolv.conf.in       $(DESTDIR)/etc/sysconfig/olpc-scripts
-	install -D altfiles/etc/sysconfig/olpc-scripts/iptables-xs.in  		$(DESTDIR)/etc/sysconfig/olpc-scripts/
-	install -D altfiles/etc/sysconfig/olpc-scripts/ip6tables-xs.in  	$(DESTDIR)/etc/sysconfig/olpc-scripts/
+	install -D altfiles/etc/sysconfig/olpc-scripts/iptables.in  		$(DESTDIR)/etc/sysconfig/olpc-scripts/
+	install -D altfiles/etc/sysconfig/olpc-scripts/ip6tables.in  	$(DESTDIR)/etc/sysconfig/olpc-scripts/
 	install -D altfiles/etc/sysconfig/olpc-scripts/firewall-xs.in  		$(DESTDIR)/etc/sysconfig/olpc-scripts/
-	install -D altfiles/etc/sudoers.d/xs-http				  $(DESTDIR)/etc/sudoers.d
 	install -D altfiles/var/named-xs/localdomain.zone         $(DESTDIR)/var/named-xs/
 	install -D altfiles/var/named-xs/localhost.zone           $(DESTDIR)/var/named-xs/
-	install -D altfiles/var/named-xs/named.broadcast          $(DESTDIR)/var/named-xs/
+	install -D altfiles/var/named-xs/named.broadcast          $(DESTDIR)/var/named-xs/ 
 	install -D altfiles/var/named-xs/named.ip6.local          $(DESTDIR)/var/named-xs/
 	install -D altfiles/var/named-xs/named.local              $(DESTDIR)/var/named-xs/
 	install -D altfiles/var/named-xs/named.rfc1912.zones      $(DESTDIR)/var/named-xs/
@@ -165,11 +163,9 @@ install: $(DESTDIR)
 	install -D -d $(DESTDIR)/etc/systemd
 	install -D -d $(DESTDIR)/etc/systemd/system
 	install -D -d $(DESTDIR)/library/pgsql-xs
-	install -D -d $(DESTDIR)/etc/pki/CA/newcerts/admin
 	install -D altfiles/etc/pgsql-xs/p*.conf $(DESTDIR)/etc/pgsql-xs
 	install -D altfiles/etc/sysconfig/pgsql/pgsql-xs $(DESTDIR)/etc/sysconfig/pgsql
 	install -D altfiles/etc/systemd/system/*.service.in $(DESTDIR)/etc/systemd/system
-	install -D altfiles/etc/pki/CA/newcerts/admin/self.pem $(DESTDIR)/etc/pki/CA/newcerts/admin
 
 	#Non-conflicting init.d scripts
 #	install -D altfiles/etc/init.d/pgsql-xs $(DESTDIR)/etc/init.d
@@ -177,7 +173,7 @@ install: $(DESTDIR)
 #	install -D altfiles/etc/init.d/no-fsck-questions $(DESTDIR)/etc/init.d
 
 	install -D altfiles/var/named-xs/localdomain.zone         $(DESTDIR)/var/named-xs/
-
+	
 	# scripts
 	install -D -d $(DESTDIR)/usr/bin
 	install -D scripts/cat-parts   $(DESTDIR)/usr/bin
@@ -195,6 +191,3 @@ install: $(DESTDIR)
 	install -D scripts/10-olpc-net.rules $(DESTDIR)/usr/lib/udev/rules.d
 	install -D scripts/moodle-xs-init $(DESTDIR)/usr/libexec
 	install -D scripts/bootstrap-xo $(DESTDIR)/usr/bin
-	install -D scripts/xs-acpowergaps $(DESTDIR)/usr/bin
-	install -D scripts/xs-sleep $(DESTDIR)/usr/bin
-	install -D scripts/xs-sleep.glade $(DESTDIR)/usr/bin
diff --git a/altfiles/etc/init.d/ejabberd-xs b/altfiles/etc/init.d/ejabberd-xs
index 6103419..aceb8a2 100755
--- a/altfiles/etc/init.d/ejabberd-xs
+++ b/altfiles/etc/init.d/ejabberd-xs
@@ -73,7 +73,7 @@ update_domain() {
 
     new_name=$short_host.$domain
 
-    (sed -e s/@@BASEDNSNAME2@@/$new_name/ $CONFIG_FILE.in > $CONFIG_FILE.tmp ) && mv $CONFIG_FILE.tmp $CONFIG_FILE || exit 1
+    (sed -e s/@@BASEDNSNAME@@/$new_name/ $CONFIG_FILE.in > $CONFIG_FILE.tmp ) && mv $CONFIG_FILE.tmp $CONFIG_FILE || exit 1
 
     # If we are changing the domain, we must clear the DB.
     if [ -e /var/lib/ejabberd/online_src_created ] ; then
diff --git a/altfiles/etc/pki/CA/newcerts/admin/self.pem b/altfiles/etc/pki/CA/newcerts/admin/self.pem
deleted file mode 100644
index 25f283a..0000000
--- a/altfiles/etc/pki/CA/newcerts/admin/self.pem
+++ /dev/null
@@ -1,51 +0,0 @@
------BEGIN PRIVATE KEY-----
-MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC+3GVE+iBFfDsR
-GVs9LpTZJhLsguldxAeH2/YTXh9ZQwWtxOBz2zufps5U0vvymrjkEZ81/DLg3EWq
-EdZvLpMR/k/TuNfLPXigv5u3dci56Ol+N+HdE855b8K0V9hUgpQ3fbdTA95IQSmd
-Risww0tTAj/AV9GICIAtylT2YrcoqaG4Am5+iyh5DhJAIqzzopPgnA+/2TZ0KRBs
-SSHds5ASwvQv+EcpxgLV4NMWWrx4wR+zsrm1ijTdqWOLrEc4f/CJTFEAeARfHfU7
-JECyAwb5DGJ5jCNCds326erZRqHyP59cXAC1HYBXx3nglGgcdacFS+yA2STbXZ5y
-9cPiOX0ZAgMBAAECggEATf5IT9iaqWprxMAE3cqUPuxlHUsdzBhYL3d+Zkm3K8XM
-o0bppc533fTPKjCRjoEVfvWIhwoJTIQW37msVADHTroKqu1FGaOEEMRcAKtcHESG
-bfKuFKaMYGmAOiwPlfFKWibAbGcPRZ2DQOa0rZeQx1oK7TG1yQ4YOx4MfCa4zB9Y
-DdJm1FEm8H1ZE2HlbK8fa91uk2pSywYnxwuFa0v6ouJbcI3IKOYtAlA88t5oNYwf
-thvuUoOMUUK90tBPYgigt2knPSMSmejBbTrmj89k8dTKcHsMObWrWiGf+kXn5zMe
-tpfh2E0kgSzTB/6g/7/RYofQsD1499tgof8vmIDE0QKBgQD0MKE0NwmrFMeaoIaJ
-2f+FAXnn7SHQQrGWkJ8PbkwxQDFg2Xj+FM/5KqgY98ac0qmRMQXLe80LRv6w6hCJ
-0HOz5VPVi2pYS4Qhlf6/9nkkVREu5vyc4Uyo/M+GX8jxPUouJd9qorz1TvUf4yf4
-RtA8ez50JqbxAJRXt4fM9CieFQKBgQDIF3y2kX4muTk2jFu69WwS2SkSc1tLzCa0
-R+Xx++riTG1THJicLAExqyvjAwuU949xgZRjcYk/wfpmaXUZtu2++jG3JohdWUN6
-GKxzEOHF86h+iB4XRJMaEnDJK5OZDBuraS6XC4hxvP8V81oERdx3GyWiGwdRnkY8
-k69VQHEn9QKBgCLhA1Wi+uWN7Ujf3ve3xLCp2lDPZUILFLSt6ZpZpdZvFd6AkbCx
-JlevyRzv31WtHX1YpDxBbbNLq7t3Y29b7/rlKclZxZHhD3mApEelG/6di/vIEJMT
-91A39Ch8bAZRO9RFopjnr9fWNFsepinna30IGY6bqsLH02iIFYSn51lVAoGAJToB
-cPIWt1ukolpwwpLgnY0bkBw4MxzzYn0x8dh9tcakXF8ooX2qZzRCgQTTBc8dN+/0
-zJ+V+m+7h4w9RiB7kRl5YGrh2gQ+gpvOkcXlS2/uvEPU3V1bxPEDXNonpsTS7Qwv
-p9h0dTzFdK8G416gCuTZFpTSwsOgq6qKZ2EK7HUCgYEA2KIrR8RQsVqoeInk+RcF
-60162PY5ZAGF/XJsOBF2L/2NAIcsR/8WQUPKf3qi2lFqpD8Mutup52nexAXqrlTp
-CRyqJXvtb/kqKm+drC5gbE1IFEdhF0Ym5ZnoC07jgm4yVN0iEztQ8gz4nCylm4gp
-Q/8ti1cXQMfVrqpp+3OoLjE=
------END PRIVATE KEY-----
------BEGIN CERTIFICATE-----
-MIID0TCCArmgAwIBAgIJAPnufmAnKQZCMA0GCSqGSIb3DQEBBQUAMH8xCzAJBgNV
-BAYTAnVzMREwDwYDVQQIDAhOZXcgWW9yazERMA8GA1UEBwwITmV3IFlvcmsxDTAL
-BgNVBAoMBE9MUEMxFTATBgNVBAMMDHNjaG9vbHNlcnZlcjEkMCIGCSqGSIb3DQEJ
-ARYVZ2Vvcmdlamh1bnRAZ21haWwuY29tMB4XDTEyMTAxMzIwMjQyM1oXDTEzMTAx
-MzIwMjQyM1owfzELMAkGA1UEBhMCdXMxETAPBgNVBAgMCE5ldyBZb3JrMREwDwYD
-VQQHDAhOZXcgWW9yazENMAsGA1UECgwET0xQQzEVMBMGA1UEAwwMc2Nob29sc2Vy
-dmVyMSQwIgYJKoZIhvcNAQkBFhVnZW9yZ2VqaHVudEBnbWFpbC5jb20wggEiMA0G
-CSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC+3GVE+iBFfDsRGVs9LpTZJhLsguld
-xAeH2/YTXh9ZQwWtxOBz2zufps5U0vvymrjkEZ81/DLg3EWqEdZvLpMR/k/TuNfL
-PXigv5u3dci56Ol+N+HdE855b8K0V9hUgpQ3fbdTA95IQSmdRisww0tTAj/AV9GI
-CIAtylT2YrcoqaG4Am5+iyh5DhJAIqzzopPgnA+/2TZ0KRBsSSHds5ASwvQv+Ecp
-xgLV4NMWWrx4wR+zsrm1ijTdqWOLrEc4f/CJTFEAeARfHfU7JECyAwb5DGJ5jCNC
-ds326erZRqHyP59cXAC1HYBXx3nglGgcdacFS+yA2STbXZ5y9cPiOX0ZAgMBAAGj
-UDBOMB0GA1UdDgQWBBQWIrngPhG5ffKWwmBd4ivrd8uw9DAfBgNVHSMEGDAWgBQW
-IrngPhG5ffKWwmBd4ivrd8uw9DAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBBQUA
-A4IBAQBpI6puXqWdQmV9YUmbctEvHf8gVh/D1jaxbKDXHwTf7XoEdd+ubt056/Mk
-GJ6dZ3Au+XE7ertednF9UsinIoyDqeNZFHx/ADqMga3TainXh3tO86hX5DGeG34d
-M8psbPJoCbioICoVlboQ3h9QiKSNJtgve0snGCUFIm1Nv4XBgJtxmelm31JXqntp
-PVm49gDvwuCe9le8cVLhEg+ZuujAqAZEOBSRmBFwOcc3gyqK8iUs6dGUZz9VoTgX
-C0opEzHL4Fk6Sk3+aRDk/wNQUsK4NoNwxkTMaEhYef13KMR/3au0el0bs6P5bxaz
-iZOqzB4VPVoNplrQ4KcjyDYSPQf4
------END CERTIFICATE-----
diff --git a/altfiles/etc/sudoers.d/xs-http b/altfiles/etc/sudoers.d/xs-http
deleted file mode 100644
index 5113ca1..0000000
--- a/altfiles/etc/sudoers.d/xs-http
+++ /dev/null
@@ -1 +0,0 @@
-apache ALL=NOPASSWD: /usr/sbin/iptables-save,/usr/sbin/fdisk,/usr/fin/xs-flashbench
diff --git a/altfiles/etc/sysconfig/ip6tables-config.in b/altfiles/etc/sysconfig/ip6tables-config.in
index 7d858fb..55094fa 100644
--- a/altfiles/etc/sysconfig/ip6tables-config.in
+++ b/altfiles/etc/sysconfig/ip6tables-config.in
@@ -3,7 +3,7 @@
 ## This file has an ".in" template - for details see
 ##  see /usr/share/doc/xs-config-<version>/README 
 
-IP6TABLES_DATA=/etc/sysconfig/olpc-scripts/ip6tables-xs
+IP6TABLES_DATA=/etc/sysconfig/olpc-scripts/ip6tables
 xs-gen-iptables $IP6TABLES_DATA
 
 # Load additional ip6tables modules (nat helpers)
diff --git a/altfiles/etc/sysconfig/iptables-config.in b/altfiles/etc/sysconfig/iptables-config.in
index 1821c63..454bf20 100644
--- a/altfiles/etc/sysconfig/iptables-config.in
+++ b/altfiles/etc/sysconfig/iptables-config.in
@@ -3,10 +3,8 @@
 ## This file has an ".in" template - for details see
 ##  see /usr/share/doc/xs-config-<version>/README 
 
-IPTABLES_DATA=/etc/sysconfig/iptables
-#xs-gen-iptables $IPTABLES_DATA
-/etc/sysconfig/olpc-scripts/firewall-xs
-iptables-save > $IPTABLES_DATA
+IPTABLES_DATA=/etc/sysconfig/olpc-scripts/iptables
+xs-gen-iptables $IPTABLES_DATA
 
 # Load additional iptables modules (nat helpers)
 #   Default: -none-
diff --git a/altfiles/etc/sysconfig/olpc-scripts/domain_config.d/ejabberd b/altfiles/etc/sysconfig/olpc-scripts/domain_config.d/ejabberd
index dd39b7f..e5f8700 100755
--- a/altfiles/etc/sysconfig/olpc-scripts/domain_config.d/ejabberd
+++ b/altfiles/etc/sysconfig/olpc-scripts/domain_config.d/ejabberd
@@ -8,7 +8,6 @@ SERVICE_NAME=ejabberd-xs
 CONFIG_LIST="/etc/ejabberd/ejabberd-xs.cfg"
 
 # taken from ejabberd spec %post
-# taken from ejabberd spec %post
 #function do-cert(){
 #    (cd /etc/ejabberd
 #    if [ ! -f ejabberd.pem ]
diff --git a/altfiles/etc/sysconfig/olpc-scripts/domain_config.d/named b/altfiles/etc/sysconfig/olpc-scripts/domain_config.d/named
index ed0fc99..b911283 100755
--- a/altfiles/etc/sysconfig/olpc-scripts/domain_config.d/named
+++ b/altfiles/etc/sysconfig/olpc-scripts/domain_config.d/named
@@ -18,7 +18,8 @@ CONFIG_LIST="/etc/named-xs.conf /var/named-xs/school.internal.zone.in-addr.db /v
 #  This is the suffix which original versions of modified files will have
 BACKUP_SUFFIX=old
 
-new_name=$1
+short_host=`hostname -s`
+new_name=$short_host.$1
 
 for config in $CONFIG_LIST;
 do
diff --git a/altfiles/etc/sysconfig/olpc-scripts/ip6tables-xs.in b/altfiles/etc/sysconfig/olpc-scripts/ip6tables-xs.in
deleted file mode 100644
index be1fd05..0000000
--- a/altfiles/etc/sysconfig/olpc-scripts/ip6tables-xs.in
+++ /dev/null
@@ -1,14 +0,0 @@
-# Simple XS IPv6 firewall config, to be extended later when IPv6 configuration
-# has been more thoroughly designed and reviewed.
-*filter
-:INPUT ACCEPT [0:0]
-:FORWARD ACCEPT [0:0]
-:OUTPUT ACCEPT [0:0]
--A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
--A INPUT -p ipv6-icmp -j ACCEPT
--A INPUT -i lo -j ACCEPT
--A INPUT -i @@LAN@@ -j ACCEPT
--A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
--A INPUT -j REJECT --reject-with icmp6-adm-prohibited
--A FORWARD -j REJECT --reject-with icmp6-adm-prohibited
-COMMIT
diff --git a/altfiles/etc/sysconfig/olpc-scripts/ip6tables.in b/altfiles/etc/sysconfig/olpc-scripts/ip6tables.in
new file mode 100644
index 0000000..df7daf5
--- /dev/null
+++ b/altfiles/etc/sysconfig/olpc-scripts/ip6tables.in
@@ -0,0 +1,14 @@
+# Simple XS IPv6 firewall config, to be extended later when IPv6 configuration
+# has been more thoroughly designed and reviewed.
+*filter
+:INPUT ACCEPT [0:0]
+:FORWARD ACCEPT [0:0]
+:OUTPUT ACCEPT [0:0]
+-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
+-A INPUT -p ipv6-icmp -j ACCEPT
+-A INPUT -i lo -j ACCEPT
+-A INPUT ! -i  @@WAN@@ -j ACCEPT
+-A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
+-A INPUT -j REJECT --reject-with icmp6-adm-prohibited
+-A FORWARD -j REJECT --reject-with icmp6-adm-prohibited
+COMMIT
diff --git a/altfiles/etc/sysconfig/olpc-scripts/iptables-xs.in b/altfiles/etc/sysconfig/olpc-scripts/iptables-xs.in
deleted file mode 100644
index 28ce9c7..0000000
--- a/altfiles/etc/sysconfig/olpc-scripts/iptables-xs.in
+++ /dev/null
@@ -1,31 +0,0 @@
-*nat
-:PREROUTING ACCEPT [0:0]
-:POSTROUTING ACCEPT [0:0]
-:OUTPUT ACCEPT [0:0]
-@@SQUID@@
--A POSTROUTING -o @@WAN@@ -j MASQUERADE
-COMMIT
-*filter
-:INPUT ACCEPT [0:0]
-:FORWARD ACCEPT [0:0]
-:OUTPUT ACCEPT [0:0]
--A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
--A INPUT -p icmp -j ACCEPT
--A INPUT -i lo -j ACCEPT
-
-# Allow ssh access on all interfaces
--A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
-
-# Allow all LAN services
--A INPUT ! -i @@WAN@@ -m state --state NEW -j ACCEPT
-
-# NAT is allowed
--A FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT
--A FORWARD -p icmp -j ACCEPT
--A FORWARD -i lo -j ACCEPT
--A FORWARD -o @@WAN@@ -j ACCEPT
-
-# Reject everything else
--A INPUT -j REJECT --reject-with icmp-host-prohibited
--A FORWARD -j REJECT --reject-with icmp-host-prohibited
-COMMIT
diff --git a/altfiles/etc/sysconfig/olpc-scripts/iptables.in b/altfiles/etc/sysconfig/olpc-scripts/iptables.in
new file mode 100644
index 0000000..28ce9c7
--- /dev/null
+++ b/altfiles/etc/sysconfig/olpc-scripts/iptables.in
@@ -0,0 +1,31 @@
+*nat
+:PREROUTING ACCEPT [0:0]
+:POSTROUTING ACCEPT [0:0]
+:OUTPUT ACCEPT [0:0]
+@@SQUID@@
+-A POSTROUTING -o @@WAN@@ -j MASQUERADE
+COMMIT
+*filter
+:INPUT ACCEPT [0:0]
+:FORWARD ACCEPT [0:0]
+:OUTPUT ACCEPT [0:0]
+-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
+-A INPUT -p icmp -j ACCEPT
+-A INPUT -i lo -j ACCEPT
+
+# Allow ssh access on all interfaces
+-A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
+
+# Allow all LAN services
+-A INPUT ! -i @@WAN@@ -m state --state NEW -j ACCEPT
+
+# NAT is allowed
+-A FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT
+-A FORWARD -p icmp -j ACCEPT
+-A FORWARD -i lo -j ACCEPT
+-A FORWARD -o @@WAN@@ -j ACCEPT
+
+# Reject everything else
+-A INPUT -j REJECT --reject-with icmp-host-prohibited
+-A FORWARD -j REJECT --reject-with icmp-host-prohibited
+COMMIT
diff --git a/cfg/etc/NetworkManager/system-connections/Sugar Modem Connection b/cfg/etc/NetworkManager/system-connections/Sugar Modem Connection
deleted file mode 100644
index 2ccadbd..0000000
--- a/cfg/etc/NetworkManager/system-connections/Sugar Modem Connection	
+++ /dev/null
@@ -1,20 +0,0 @@
-
-[connection]
-id=Sugar Modem Connection
-uuid=62be9bcb7a3d3929fc01d82e038c42f93b339334
-type=gsm
-autoconnect=false
-
-[ppp]
-lcp-echo-failure=5
-lcp-echo-interval=30
-
-[ipv4]
-method=auto
-ignore-auto-dns=true
-
-[serial]
-baud=115200
-
-[gsm]
-number=*99#
diff --git a/cfg/etc/NetworkManager/system-connections/dhcp b/cfg/etc/NetworkManager/system-connections/dhcp
index a57fe7e..c266a0b 100755
--- a/cfg/etc/NetworkManager/system-connections/dhcp
+++ b/cfg/etc/NetworkManager/system-connections/dhcp
@@ -7,7 +7,6 @@ timestamp=1348017380
 
 [ipv4]
 method=auto
-ignore-auto-dns=true
 
 [802-3-ethernet]
 duplex=full
diff --git a/cfg/etc/profile.d/bashrc_xs.sh b/cfg/etc/profile.d/bashrc_xs.sh
index 711956b..d1468e7 100644
--- a/cfg/etc/profile.d/bashrc_xs.sh
+++ b/cfg/etc/profile.d/bashrc_xs.sh
@@ -130,7 +130,7 @@ function fastprompt()
     case $TERM in
         *term | rxvt )
             #PS1="${HILIT}[\h]$NC \W > \[\033]0;\${TERM} [\u@\h] \w\007\]" ;;
-            PS1="${HILIT}[\u@\h]$NC \W >"  ;;
+            PS1="${HILIT}[\h]$NC \W >"  ;;
         linux )
             PS1="${HILIT}[\h]$NC \W > " ;;
         *)
@@ -159,8 +159,7 @@ function powerprompt()
     esac
 }
 
-fastprompt
-#powerprompt     # This is the default prompt -- might be slow.
+powerprompt     # This is the default prompt -- might be slow.
                 # If too slow, use fastprompt instead. ...
 
 #===============================================================
diff --git a/cfg/etc/yum.repos.d/media.repo b/cfg/etc/yum.repos.d/media.repo
deleted file mode 100644
index 9752f77..0000000
--- a/cfg/etc/yum.repos.d/media.repo
+++ /dev/null
@@ -1,6 +0,0 @@
-[usb-media]
-name=usb-media
-baseurl=file:///
-enabled=1
-gpgcheck=0
-cost=100
diff --git a/cfg/html/top/bin/mem b/cfg/html/top/bin/mem
deleted file mode 100755
index c69c859..0000000
--- a/cfg/html/top/bin/mem
+++ /dev/null
@@ -1,8 +0,0 @@
-#!/bin/bash 
-# report memory usage
-free -m
-echo
-echo -n "Total free is "
-free -m | gawk '/buffers\/cache/ {free = $4};/^Mem:/{tot=$2};END {print free," out of ",tot," = ",free/tot*100,"%"};'
-echo -n "Adding up all process memory usage in percent: "
-echo `ps aux|gawk '{sum +=$4};END {print sum}'`
diff --git a/cfg/html/top/bin/sdformat.awk b/cfg/html/top/bin/sdformat.awk
deleted file mode 100644
index 37cb403..0000000
--- a/cfg/html/top/bin/sdformat.awk
+++ /dev/null
@@ -1,30 +0,0 @@
-# awk program to create the script to format an SD card correctly
-#
-/^\/dev\/mmcblk0/ {start = $2; end = $3; blocks =  $4;}
-/^Units/ {unit = $9;}
-/^Disk \/dev/ { total_bytes = $5;}
-# assume that the start is the errase block size
-END {
-if (start != 0) {
-	#assume that start is equal to erase block size
-	erase_block_size = start;
-	SWAP_MB = 512;
-	swap_size = SWAP_MB * 1024 * 1024;
-	swap_num_erase_blocks = int(swap_size / (erase_block_size * 512));
-	erase_blocks = int(end / start);
-	#print "erase blocks: " erase_blocks "number of swap erase blocks:" swap_num_erase_blocks;
-	swap_begin = int(erase_blocks - swap_num_erase_blocks) * 8192;
-	if ((end + 1) * unit != total_bytes) {
-		print "Totat bytes not equal blocks * unit";
-		print "end:"  end  "  unit:"  unit  "  total bytes:"  total_bytes;
-		print " from fdisk:" unit * end;
-		exit(1);
-	}
-	print ""
-	print "fdisk with partition 1 starting at " start " ending at " swap_begin -1 ;
-	print "  and swap partition starting at " swap_begin " and ending at " end ;
-	print ""
-	print "Then format with mke2fs.ext4 -b 4096 -O ^has_journal --stride=2 /dev/mmcblk0p1"
-	print "  And format the swap partition with 'mkswap /dev/mmcblk0p2'"
-}
-}	
diff --git a/cfg/html/top/bin/sdinfo b/cfg/html/top/bin/sdinfo
deleted file mode 100755
index 49d842a..0000000
--- a/cfg/html/top/bin/sdinfo
+++ /dev/null
@@ -1,6 +0,0 @@
-#!/bin/bash
-# report sd info in prep for reformatting
-sudo fdisk -l /dev/mmcblk0
-base=`dirname  "$0"`
-sudo fdisk -l /dev/mmcblk0 | gawk -f $base/sdformat.awk
-
diff --git a/cfg/html/top/en/SS_menu.html b/cfg/html/top/en/SS_menu.html
index 5621849..a6ee92f 100644
--- a/cfg/html/top/en/SS_menu.html
+++ b/cfg/html/top/en/SS_menu.html
@@ -9,9 +9,9 @@
 </head>
 
 <body class="nav">
-<h2>Server</h2>
+<h2>School Server</h2>
 <ul>
-<a class="nav" href="cnt_service_summary.php" target="formframe">XS Services</a><br />
+<a class="nav" href="cnt_service_summary.php" target="formframe">Services</a><br />
 <a class="nav" href="cnt_process_tree.php" target="formframe">Processes</a><br />
 <a class="nav" href="cnt_test.php" target="formframe">PHP Setup</a><br />
 <a class="nav" href="/novnc/vnc_auto.html?HOST=172.18.96.1&port=6080" target="_blank">Screen</a><br />
@@ -21,5 +21,9 @@
 <a class="nav" href="cnt_net-config.php" target="formframe">Setup</a><br />
 <a class="nav" href="cnt_interface_info.php" target="formframe">Devices</a><br />
 </ul>
+<h2>Add/Remove</h2>
+<ul>
+<a class="nav" href="pick_services.html" target="formframe">Network</a><br />
+</ul>
 </body>
 </html>
diff --git a/cfg/html/top/en/acgaps.php b/cfg/html/top/en/acgaps.php
deleted file mode 100644
index fae1489..0000000
--- a/cfg/html/top/en/acgaps.php
+++ /dev/null
@@ -1,30 +0,0 @@
-<?php 
-	$SUMMARIZE_SERVICES = "/usr/bin/xs-acpowergaps";
-	$results = shell_exec($SUMMARIZE_SERVICES);
-	$lines = explode("\n",$results);
-?>
-<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml">
-<head>
-<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
-<title>Running Services</title>
-</head>
-
-<body>
-<div align="center">
-<h1>Memory Usage</h1>
-<div align="left">
-<pre>
-    <?php 
-	foreach($lines as $line){
-		echo($line);
-		echo("<br />");
-	}
-	?>
-</pre>
-</div>
-
-</div>
-
-</body>
-</html>
diff --git a/cfg/html/top/en/dig.php b/cfg/html/top/en/dig.php
deleted file mode 100644
index 462659b..0000000
--- a/cfg/html/top/en/dig.php
+++ /dev/null
@@ -1,27 +0,0 @@
-<?php 
-	$SUMMARIZE_SERVICES = "dig yahoo.com";
-	$results = shell_exec($SUMMARIZE_SERVICES);
-	$lines = explode("\n",$results);
-?>
-<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml">
-<head>
-<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
-<title>Running Services</title>
-</head>
-
-<body>
-<div align="center">
-<h1>Name Server Response</h1></div>
-<div align="left" class="bash_script">
-<pre>
-    <?php 
-	foreach($lines as $line){
-		echo($line . "<br />");
-	}
-	?>
-</pre>
-</div>
-
-</body>
-</html>
diff --git a/cfg/html/top/en/formatsd.php b/cfg/html/top/en/formatsd.php
deleted file mode 100644
index 111103a..0000000
--- a/cfg/html/top/en/formatsd.php
+++ /dev/null
@@ -1,35 +0,0 @@
-<?php 
-	$SUMMARIZE_SERVICES = "../bin/sdinfo";
-	$results = shell_exec($SUMMARIZE_SERVICES);
-	$lines = explode("\n",$results);
-?>
-<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml">
-<head>
-<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
-<title>Running Services</title>
-</head>
-
-<body>
-<div align="center">
-<h1>SD Information</h1>
-</div>
-
-<div align="left">
-	<pre>
-    <?php 
-	foreach($lines as $line){
-		echo($line);
-		echo("<br />");
-	}
-/*	$SUMMARIZE_SERVICES = "/usr/bin/sudo /usr/bin/xs-flashbench -a /dev/mmcblk0";
-	$results = shell_exec($SUMMARIZE_SERVICES);
-	$lines = explode("\n",$results); */
-	?>
-	</pre>
-</div>
-
-
-
-</body>
-</html>
diff --git a/cfg/html/top/en/index.html b/cfg/html/top/en/index.html
index 067cd48..2e410e8 100644
--- a/cfg/html/top/en/index.html
+++ b/cfg/html/top/en/index.html
@@ -6,7 +6,6 @@
 <meta http-equiv="content-type" content="text/html;charset=ISO-8859-1">
 <title>School Server Remote Access</title>
 <link href="../schsrv.css" rel="stylesheet" type="text/css" />
-<script language="JavaScript" type="text/JavaScript" src="../vnc.js"></script>
 <script language="JavaScript" type="text/javascript">
 
 //a variable to keep track of the vnc window
@@ -17,12 +16,10 @@ function setup_click() {
 	nav.src="pick_services.php";
 }
 function classroom_click() {
-	var nav=document.getElementById("formframe");
-	nav.src="registrations.php";
+	window.frames['formframe'].src="cnt_service_summary.php";
 }
 function tools_click() {
-	var nav=document.getElementById("formframe");
-	nav.src="dig.php";
+	window.frames['formframe'].src="cnt_service_summary.php"
 }
 function status_click() {
 	var nav=document.getElementById("formframe");
@@ -34,8 +31,7 @@ function status_click() {
     <div class="nav" height="40px" width="100%">
     <table width="100%" align="center" border="0">
   <tr>
-    <td width="10%"><a  class="nav" href="" onClick="popvnc();">XS Remotely </a>
-</td>
+    <td width="10%">&nbsp;</td>
     <td width="10%">&nbsp;</td>
     <td width="10%">&nbsp;</td>
     <td width="10%"><a class="nav" href="setup_nav.html" target="navigation" onClick="setup_click()">Setup</a></td>
diff --git a/cfg/html/top/en/memory.php b/cfg/html/top/en/memory.php
deleted file mode 100644
index a62da2d..0000000
--- a/cfg/html/top/en/memory.php
+++ /dev/null
@@ -1,30 +0,0 @@
-<?php 
-	$SUMMARIZE_SERVICES = "../bin/mem";
-	$results = shell_exec($SUMMARIZE_SERVICES);
-	$lines = explode("\n",$results);
-?>
-<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml">
-<head>
-<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
-<title>Running Services</title>
-</head>
-
-<body>
-<div align="center">
-<h1>Memory Usage</h1>
-<div align="left">
-<pre>
-    <?php 
-	foreach($lines as $line){
-		echo($line);
-		echo("<br />");
-	}
-	?>
-</pre>
-</div>
-
-</div>
-
-</body>
-</html>
diff --git a/cfg/html/top/en/pick_services.php b/cfg/html/top/en/pick_services.php
index 2a70368..e701d26 100644
--- a/cfg/html/top/en/pick_services.php
+++ b/cfg/html/top/en/pick_services.php
@@ -8,9 +8,9 @@
 <script language="JavaScript" type="text/JavaScript">
 
 function toggleMenu(objID) {
-	if (!document.getElementById) return;
-	var ob = document.getElementById(objID).style;
-	ob.display = (ob.display == 'block')?'none': 'block';
+if (!document.getElementById) return;
+var ob = document.getElementById(objID).style;
+ob.display = (ob.display == 'block')?'none': 'block';
 }
 </script>
 
@@ -19,19 +19,18 @@ function toggleMenu(objID) {
 <body>
 <div class="centerframe">
 <h2>Internet:</h2>
-  <input name="have_internet" class="mH" onclick="toggleMenu('menu1')"type="checkbox" value="" />
+  <input name="have_internet" type="checkbox" value="" />
 Check here if you have internet service and want the School Server to provide internet services to XO laptops.<br />
-<div id="menu1" class="mL">
-  <input name="name_server_censor" class="mO" type="checkbox"  value="" />
+  <input name="name_server_censor" type="checkbox" class="level1" value="" />
 Enable Domain Name Service content controls using OPENDNS (is mainteined for schools worldwide by specialists)<br />
-  <input name="dans_guardian_censor" class="mO" type="checkbox"  value="" />
+  <input name="dans_guardian_censor" type="checkbox" class="level1" value="" />
 Install Dan's Guardian content filter (permits local control, requires setup, continued maintenance) 
 <h3>Internet Speedups</h3>
 Is your internet speed faster than 1Megabit for 5 students, 5 Megabits for 30 students, or 15Mebagits for 75 students? If not:<br />
-  
-<input name="enable_squid" class="mO" type="checkbox" value="" />
+<div class="level1">  
+<input name="enable_squid" type="checkbox" value="" />
 Enable local web page storage for later fast access<br />
-  <input name="enable_named" class="mO" type="checkbox" value="" />
+  <input name="enable_named" type="checkbox" value="" />
 Enable local Domain Name storage for faster access</div>
 </div>
 </body>
diff --git a/cfg/html/top/en/ping.php b/cfg/html/top/en/ping.php
deleted file mode 100644
index 0810c26..0000000
--- a/cfg/html/top/en/ping.php
+++ /dev/null
@@ -1,48 +0,0 @@
-<?php 
-	$PING = "ping -c 4  yahoo.com";
-	$results = shell_exec($PING);
-	$lines = explode("\n",$results);
-?>
-<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml">
-<head>
-<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
-<title>Ping inside and outside</title>
-<link href="../schsrv.css" rel="stylesheet" type="text/css" />
-</head>
-
-<body>
-<div align="center">
-<h2>Contact Internet</h2></div> 
-<div align="left" class="bash_output">
-<pre>
-    <?php 
-	foreach($lines as $line){
-		$nibbles = explode("\t",$line);
-		foreach($nibbles as $value){
-			echo("$value" . '<br />');
-		}
-	}
-	?>
-    </pre>
-</div>
-<div align="center">
-<h2>Internal Network</h2></div> 
-<div align="left" class="bash_output">
-<pre>
-<?php 
-	$PING = "avahi-browse -a -t | grep Workstation";
-	$results = shell_exec($PING);
-	$lines = explode("\n",$results);
-	foreach($lines as $line){
-		$nibbles = explode("\t",$line);
-		foreach($nibbles as $value){
-			echo("$value" . '<br />');
-		}
-	}
-?>
-
-</pre>
-</div>
-</body>
-</html>
diff --git a/cfg/html/top/en/registrations.php b/cfg/html/top/en/registrations.php
index 53c1200..d592264 100644
--- a/cfg/html/top/en/registrations.php
+++ b/cfg/html/top/en/registrations.php
@@ -12,14 +12,19 @@
 
 <body>
 <div align="center">
-<h1>Journal Backups</h1>
+<h1>JOURNAL DATA FOR</h1>
+<table width="80%" border="0">
     <?php 
 	foreach($lines as $line){
-		echo($line);
-		echo("<br />");
+		$nibbles = explode("\t",$line);
+  		echo("<tr>");
+		foreach($nibbles as $value){
+			echo("<td>$value</td>");
+		}
+  		echo("</tr>");
 	}
 	?>
-</div>
+</table></div>
 
 </body>
 </html>
diff --git a/cfg/html/top/en/status_nav.html b/cfg/html/top/en/status_nav.html
index 5de8cff..4b36898 100644
--- a/cfg/html/top/en/status_nav.html
+++ b/cfg/html/top/en/status_nav.html
@@ -16,7 +16,8 @@
 <a class="nav" href="cnt_service_summary.php" target="formframe">XS Services</a><br />
 <a class="nav" href="cnt_process_tree.php" target="formframe">Processes</a><br />
 <a class="nav" href="cnt_test.php" target="formframe">PHP Setup</a><br />
-<a class="nav" href="memory.php" target="formframe">Memory Use</a><br />
+<!--<a class="nav" href="/novnc/vnc_auto.html?HOST=172.18.96.1&port=6080" target="_blank">Screen</a><br />-->
+<a  class="nav" href="#" onclick="popvnc();">MyScreen </a>
 </ul>
 <h2>Network</h2>
 <ul>
diff --git a/cfg/html/top/en/tools_nav.html b/cfg/html/top/en/tools_nav.html
deleted file mode 100644
index c330cd5..0000000
--- a/cfg/html/top/en/tools_nav.html
+++ /dev/null
@@ -1,22 +0,0 @@
-<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml">
-<head>
-<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
-<META http-equiv=Pragma content=no-cache>
-<META http-equiv=Cache-Control content=no-cache>    
-<title>Setup Navigation Pane</title>
-<link href="../schsrv.css" rel="stylesheet" type="text/css" />
-</head>
-
-<body class="nav">
-<h2>Tools</h2>
-<a class="nav" href="ping.php" target="formframe">Test Connections</a><br />
-<a class="nav" href="dig.php" target="formframe">Test Nameserver</a><br />
-<a class="nav" href="formatsd.php" target="formframe">Format SD Card</a><br />
-<a class="nav" href="/novnc/vnc_auto.html?HOST=172.18.96.1&port=6080&true_color=1" 
-<a class="nav" href="acgaps.php" target="formframe">AC Power Report</a><br />
-
-target="_blank">Unencrypted VNC</a><br />
-
-</body>
-</html>
diff --git a/cfg/html/top/en/xo_services.php b/cfg/html/top/en/xo_services.php
index b7af3a0..31a7b11 100644
--- a/cfg/html/top/en/xo_services.php
+++ b/cfg/html/top/en/xo_services.php
@@ -8,14 +8,12 @@
 		if (isset($_POST['activity_server'])) $selected['activity_server'] = 'on'; else $selected['activity_server'] = 'off';
 		if (isset($_POST['moodle'])) $selected['moodle'] = 'on'; else $selected['moodle'] = 'off';
 		if (isset($_POST['security_tools'])) $selected['security_tools'] = 'on'; else $selected['security_tools'] = 'off';
-		if (isset($_POST['webdav'])) $selected['webdav'] = 'on'; else $selected['webdav'] = 'off';
 	} else {
 		$selected['register'] = (in_array("idmgr", $installed) ? 'on' : 'off');
 		$selected['ejabberd'] = (in_array("ejabberd", $installed) ? 'on' : 'off');
 		$selected['activity_server'] = (in_array("activity-server", $installed) ? 'on' : 'off');
 		$selected['moodle'] = (in_array("moodle-xs", $installed) ? 'on' : 'off');
 		$selected['security_tools'] = (in_array("security_tools", $installed) ? 'on' : 'off');
-		$selected['webdav'] = (in_array("webdav", $installed) ? 'on' : 'off');
 	}
 ?>
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
@@ -28,9 +26,9 @@
 <script language="JavaScript" type="text/JavaScript">
 
 function toggleMenu(objID) {
-	if (!document.getElementById) return;
-	var ob = document.getElementById(objID).style;
-	ob.display = (ob.display == 'block')?'none': 'block';
+if (!document.getElementById) return;
+var ob = document.getElementById(objID).style;
+ob.display = (ob.display == 'block')?'none': 'block';
 }
 </script>
 
@@ -39,7 +37,7 @@ function toggleMenu(objID) {
 <body>
 <h2>Services to the XO Laptops</h2>
 <form action="<?php echo($_SERVER['self']);?>" method="post" >
-<div class="centerpick">
+<div class="centerframe">
 <?php if ($selected['ejabberd'] == 'on') $checked = "CHECKED";  else $checked = "";?>
   <input name="ejabberd" type="checkbox"  value="" <?php echo $checked ?>/>
 Facilitate collaboration by centralizing identity information (ejabber server)<br />
@@ -54,12 +52,8 @@ Store and serve new or updated Activities to XO's, input from a USB stick.<br />
 Use the Moodle content and classroom management system<br />
 <?php if ($selected['security_tools'] == 'on') $checked = "CHECKED";  else $checked = "";?>
   <input name="security_tools" type="checkbox" value="" <?php echo $checked ?>/>
-Manage activation of XO leases, and security.<br  />
-<?php if ($selected['webdav'] == 'on') $checked = "CHECKED";  else $checked = "";?>
-  <input name="webdav" type="checkbox" value="" <?php echo $checked ?>/>
-Enable the storage and retrieval of files on the server using WebDav.<br  />
-</div>
   <input name="token" type="hidden" />
+Manage activation of XO leases, and security.</div>
 <div align="center"> <input name="Apply" type="submit"/></div>
 </form>
 <?php 
@@ -67,27 +61,24 @@ if (isset($_POST['token'])) {
 	$outfile = '/library/webdav/apply_changes';
 	$fh = fopen($outfile,"w") or die("failed to open ". $outfile);
 	$outstr = "#!/bin/bash\n";
-	$outstr .= "# small apply script to change selected configuration of School server\n";
+	$outstr .= "# small apply script to change selecte configuration of School server\n";
 	$outstr .= "source /usr/bin/xs-setup-functions\n";
 	$outstr .= "do-first\n";
 
-	if ( $selected['register'] == 'on' and !in_array("idmgr", $installed)) 	$outstr .= "idmgr yes\n";
-	if ( $selected['register'] == 'off' and in_array("idmgr", $installed)) 	$outstr .= "idmgr no\n";
+	if ( $selected['register'] == 'on' and !in_array("idmgr", $installed)) 	$outstr .= "idmgr on\n";
+	if ( $selected['register'] == 'off' and in_array("idmgr", $installed)) 	$outstr .= "idmgr off\n";
 	
-	if ( $selected['ejabberd'] == 'on' and !in_array("ejabberd", $installed)) $outstr .= "ejabberd yes\n";
-	if ( $selected['ejabberd'] == 'off' and in_array("ejabberd", $installed)) $outstr .= "ejabberd no\n";
+	if ( $selected['ejabberd'] == 'on' and !in_array("ejabberd", $installed)) $outstr .= "ejabberd on\n";
+	if ( $selected['ejabberd'] == 'off' and in_array("ejabberd", $installed)) $outstr .= "ejabberd off\n";
 	
-	if ( $selected['activity_server'] == 'on' and !in_array("activity-server", $installed)) $outstr .= "activity_server yes\n";
-	if ( $selected['activity_server'] == 'off' and in_array("activity-server", $installed)) $outstr .= "activity_server no\n";
+	if ( $selected['activity_server'] == 'on' and !in_array("activity-server", $installed)) $outstr .= "activity_server on\n";
+	if ( $selected['activity_server'] == 'off' and in_array("activity-server", $installed)) $outstr .= "activity_server off\n";
 	
-	if ( $selected['moodle'] == 'on' and !in_array("moodle-xs", $installed)) $outstr .= "moodle yes\n";
-	if ( $selected['moodle'] == 'off' and in_array("moodle-xs", $installed)) $outstr .= "moodle no\n";
+	if ( $selected['moodle'] == 'on' and !in_array("moodle-xs", $installed)) $outstr .= "moodle on\n";
+	if ( $selected['moodle'] == 'off' and in_array("moodle-xs", $installed)) $outstr .= "moodle off\n";
 	
-	if ( $selected['security_tools'] == 'on' and !in_array("security-tools", $installed) ) $outstr .= "security_tools yes\n";
-	if ( $selected['security_tools'] == 'off' and in_array("security-tools", $installed) ) $outstr .= "security_tools no\n";
-
-	if ( $selected['webdav'] == 'on' and !in_array("webdav", $installed) ) $outstr .= "webdav yes\n";
-	if ( $selected['webdav'] == 'off' and in_array("webdav", $installed) ) $outstr .= "webdav no\n";
+	if ( $selected['security_tools'] == 'on' and !in_array("security-tools", $installed) ) $outstr .= "security_tools on\n";
+	if ( $selected['security_tools'] == 'off' and in_array("security-tools", $installed) ) $outstr .= "security_tools off\n";
 
 	$outstr .= "do-last\n";
 	fwrite($fh,$outstr);
diff --git a/cfg/html/top/index.php b/cfg/html/top/index.php
index 4c924b4..77258b3 100644
--- a/cfg/html/top/index.php
+++ b/cfg/html/top/index.php
@@ -10,13 +10,11 @@
 */
 	$filename = "./bin/lang";
 	$result = shell_exec($filename);
-	if (strlen($result)<2) $result = 'en';
 	$goto = substr($result,1,2);
 	$locationstring = "Location: ./" . $goto;
 	$workingdir = getcwd();
 	$lang_dir = $workingdir . "/" . $goto;
 	if (is_dir($lang_dir)) {
-		//die($locationstring);
 		header($locationstring);
 		exit(0);
 	}
diff --git a/cfg/html/top/schsrv.css b/cfg/html/top/schsrv.css
index 1291621..2998a7c 100644
--- a/cfg/html/top/schsrv.css
+++ b/cfg/html/top/schsrv.css
@@ -7,10 +7,6 @@
 	font-family: "Arial Black", Gadget, sans-serif;
 	font-size: 14px;
 }
-.centerpick{
-	font-family: "Arial Black", Gadget, sans-serif;
-	font-size: 16px;
-}
 .nav {
 	background-color: #58B948;
 	font-family: "Arial Black", Gadget, sans-serif;
@@ -43,7 +39,8 @@ a.nav {
 }.level1 {
 	margin-left:2%;
 }
+.mC {width:100px; margin:5px; float:right;}
 .mH {color:#60c; cursor:pointer;  font-weight:bold; border-top:1px solid #300;}
 .mL {display:none; margin-bottom:10px;}
-.mO {display:block;}
+.mO {margin-left:10px; display:block;}
                     
\ No newline at end of file
diff --git a/cfg/html/top/vnc.js b/cfg/html/top/vnc.js
index 9f08595..e714d2c 100644
--- a/cfg/html/top/vnc.js
+++ b/cfg/html/top/vnc.js
@@ -18,8 +18,7 @@ function popvnc(){
 			y = window.screenTop + 100;
 		}
 		var param='dialog, modal, toolbar=no, status=no, scrollbars=no, resizable=no, width=800, height=600 , left='+x+', top='+y+', location=no';
-<!--		parent.vncwin = window.open('/novnc/vnc_auto.html?HOST=172.18.96.1&port=6080&encrypt=1&true_color=1','School Server',param); _-->
-		parent.vncwin = window.open('/novnc/vnc_auto.html?HOST=172.18.96.1&port=6080&true_color=1','School Server',param); 
+		parent.vncwin = window.open('/novnc/vnc_auto.html?HOST=172.18.96.1&port=6080','School Server',param);
 		parent.vncwin.focus();
 		return false;
 	} else {
diff --git a/scripts/bootstrap-xo b/scripts/bootstrap-xo
index 2d15567..4ee39d5 100755
--- a/scripts/bootstrap-xo
+++ b/scripts/bootstrap-xo
@@ -6,7 +6,7 @@ FIX_RPMS="sed libidn grep which util-linux wget gnupg2 groff gnash"
 LOG=/home/olpc/xs-setup.log
 
 if [ $ISXO = "1" ]
-then
+then 
     # there are files open in the tempfs /var/log -- so we cannot just unmount it
     # we need to disable tempfs and then start up again on a /var/log directory
     # that persists
@@ -26,7 +26,9 @@ then
 	sed -i -c  's/keepcache=0/keepcache=1/' /etc/yum.conf
 
 	# disable "su" without password on the XO
-	sed -i -e '6s/^auth/#auth/' /etc/pam.d/su
+	# breaks moodle-xs install can't su to apache user 
+	#sed -i -e '1,6s/^auth/#auth/' /etc/pam.d/su
+	#sed -i -e "/^\%wheel ALL=\(ALL\) NOPASSWD\: ALL/d" /etc/sudoers
 
 	# copy .bashrc to /root
 	cp -p /home/olpc/.bashrc /root
@@ -44,16 +46,16 @@ then
 
 	# Rename the XO to be schoolserver.local
 	sed -i -e '/HOSTNAME=xo/d' /etc/sysconfig/network
-	echo "HOSTNAME=schoolserver.local" >> /etc/sysconfig/network
+        echo "HOSTNAME=schoolserver.local" >> /etc/sysconfig/network
 
 	# XO release 12.1.0 makes /var/log  a tempfs -- server logs should persist
 	sed -i -c 's:vartmp:#vartmp:' /etc/fstab
 	sed -i -c 's:varlog:#varlog:' /etc/fstab
-	echo "bootstrap-xo routine completed" | tee -a $LOG
-	date  2>&1 | tee -a $LOG
 	cp /var/log/yum.log /home/olpc/
+        echo "bootstrap-xo routine completed" | tee -a $LOG
+        date  2>&1 | tee -a $LOG
 	echo "The setup program must reboot before additional setup can proceed"
-	echo "Next step is to run 'xs-setup' when rebooted"
+	echo "Next step is to run 'xs-config' when rebooted"
 	read -p "Press [Enter] key to reboot"
 	echo "rebooting in 5 seconds"
 	sleep 5
diff --git a/scripts/xs-acpowergap-cron b/scripts/xs-acpowergap-cron
deleted file mode 100755
index df4c71c..0000000
--- a/scripts/xs-acpowergap-cron
+++ /dev/null
@@ -1,4 +0,0 @@
-#!/bin/bash
-# script to call xs-acpowergaps with flag --timeout indicating cron invocation
-xs-acpowergaps --timeout
-
diff --git a/scripts/xs-acpowergaps b/scripts/xs-acpowergaps
deleted file mode 100755
index 6aa93cd..0000000
--- a/scripts/xs-acpowergaps
+++ /dev/null
@@ -1,113 +0,0 @@
-#!/usr/bin/env python
-from time import localtime, strftime, sleep, localtime
-import time
-import datetime
-from subprocess import Popen, PIPE
-import datetime
-import os, sys
-import gconf
-import logging
-import json
-from gettext import gettext as _
-DATA_FILE = "/home/olpc/.mains_power"
-VERSION = "0.1"
-
-SYS_AC = "  /sys/class/power_supply/olpc-ac/online"
-WORK_DIR = "/home/olpc"
-
-logger = logging.getLogger('serversleep')
-hdlr = logging.FileHandler(os.path.join(WORK_DIR,'getsource.log'))
-formatter = logging.Formatter('%(asctime)s %(levelname)s %(messages)s')
-hdlr.setFormatter(formatter)
-logger.addHandler(hdlr)
-logger.setLevel(logging.WARNING)
-
-class tools:
-    def cli(self, cmd):
-        """send cmd line to shell, rtn (text,error code)"""
-        logger.debug('command_line cmd:%s'%cmd)
-        p1 = Popen(cmd,stdout=PIPE, shell=True)
-        output = p1.communicate()
-        if p1.returncode != 0 :
-            logger.debug('error returned from shell command: %s was %s'%(cmd,output[0]))
-        return output[0],p1.returncode
-
-    def tstamp(self, dtime):
-        '''return a UNIX style timestamp for datetime input'''
-        epoch = datetime.datetime(1970, 1, 1)
-        since_epoch_delta = dtime - epoch
-        return since_epoch_delta.total_seconds()
-
-class ShowPowerHistory(tools):
-    def __init__(self):
-        global cfg, first_time, last_time
-        first_time = None
-        last_time = None
-        power_on = True
-        power_gaps = 0
-        gaps = {}
-        #get the config file with previous selections
-        try:
-            fd = file(DATA_FILE,'r')
-        except IOError:
-            #this is first run of program, set up defaults
-            try:
-                fd = file(DATA_FILE,'w')
-                cfg = "START UP OF AC POWER MONITOR VERSION %s\n" % VERSION
-                fd.write(cfg)
-                fd.close()
-                fd = file(DATA_FILE,'r')
-            except IOError,e:
-                logging.exception("failed to write config str. error:%s"% (e,))
-                fd = file(DATA_FILE,'r')
-        for line in fd:
-            #print line.strip()
-            nibbles = line.split('|')
-            if (len(nibbles) > 1):
-                current = nibbles[1]
-                current_time = datetime.datetime.strptime(current.strip(),"%a %b %d %H:%M:%S %Y")
-                last_time = time.mktime(current_time.timetuple())
-                if not first_time: first_time = last_time
-                if (nibbles[0] == '0'):
-                    power_on = False
-                    power_gaps += 1
-                    start_gap = last_time
-                else:
-                    if power_on == False:
-                        power_on = True
-                        gaps[start_gap] = last_time - start_gap
-
-        diff = last_time - first_time
-        print("total length of record: %s minutes"%(diff//60, ))
-        print ("Number of power interruptions: %s"%(len(gaps)))
-        print "List of power gaps and length in munutes"
-        for key in gaps.keys():
-            print ("  gap occured on %s for %s minutes" %(time.ctime(key), gaps[key]//60))
-
-
-
-class CollectData(tools):
-    def __init__(self):
-        #get the config file with previous selections
-        try:
-            fd = file(DATA_FILE,'a')
-        except Exception,e:
-            logger.exception("cron invocation failed to read cfg. e=%s"%e)
-            return
-        # the /sys file syste has the info on status of ac input
-        line,err = self.cli('cat %s' % (SYS_AC,))
-        fd.write("%s|%s\n" % (line.strip(), time.ctime(),))
-
-
-if __name__ == "__main__":
-    # if interactive from command line, do gui
-    if len(sys.argv) == 1:
-        pi = ShowPowerHistory()
-    elif (len(sys.argv )== 2):
-        # if coming from cron, the check for an action to do
-        if sys.argv[1] == '--timeout':
-            pa = CollectData()
-        sys.exit(0)
-    # pop up the GUI
-    #Gtk.main()
-    exit(0)
diff --git a/scripts/xs-arm-flashbench b/scripts/xs-arm-flashbench
deleted file mode 100755
index 1c29e79..0000000
Binary files a/scripts/xs-arm-flashbench and /dev/null differ
diff --git a/scripts/xs-domain-config b/scripts/xs-domain-config
index 2b83e1a..2dbf0b6 100755
--- a/scripts/xs-domain-config
+++ b/scripts/xs-domain-config
@@ -38,7 +38,7 @@ else
     if [ -e "$SYSCONFIGDIR/xs_domain_name" ];then
 	new_domain_name=`cat "$SYSCONFIGDIR/xs_domain_name"`
     else
-	echo "Using default domain name"
+	echo Using default domain name
 	new_domain_name="local"
     fi
 fi
diff --git a/scripts/xs-gen-iptables b/scripts/xs-gen-iptables
index 44b70ec..8dd28be 100644
--- a/scripts/xs-gen-iptables
+++ b/scripts/xs-gen-iptables
@@ -13,8 +13,6 @@ import logging
 import sys
 import tempfile
 
-
-
 sysconfig_path = "/etc/sysconfig"
 
 if len(sys.argv) < 2:
@@ -22,10 +20,9 @@ if len(sys.argv) < 2:
      exit(1)
 
 # will try and update it atomically
-output_path = sys.argv[1]
+input_path = sys.argv[1]
 
 # default
-lan = 'eth0'
 wan = 'eth1'
 
 wanconf_path = os.path.join(sysconfig_path, 'xs_wan_device')
@@ -48,9 +45,9 @@ else:
 
 #print("wan="+wan+" squid=%i" % squid)
 
-template = open(output_path + ".in")
+template = open(input_path + ".in")
 # write it as a tmpfile in the destination directory, for an atomic update
-(destfh, tmpfile) = tempfile.mkstemp(dir=os.path.dirname(output_path))
+(destfh, tmpfile) = tempfile.mkstemp(dir=os.path.dirname(sysconfig_path))
 for line in template:
      if (re.match('@@SQUID@@', line)):
           if proxyison:
@@ -58,11 +55,10 @@ for line in template:
      else:
           # line = line.rstrip()
           line = re.sub(r'\@\@WAN\@\@', wan, line)
-          line = re.sub(r'\@\@LAN\@\@', lan, line)
           os.write(destfh, line)
 
 os.close(destfh)
 
 # update atomically
-os.rename(tmpfile, output_path)
+os.rename(tmpfile, sysconfig_path)
 
diff --git a/scripts/xs-setup b/scripts/xs-setup
index 6de637f..b590789 100755
--- a/scripts/xs-setup
+++ b/scripts/xs-setup
@@ -30,8 +30,8 @@ done
 # The user can request that we only perform setup steps if setup had been
 # previously performed by an admin. This is useful for automated upgrades
 # (e.g. RPM post scripts).
-if [ -n "$opt_upgrade_only" ]; then
-	echo "$0: doing nothing, upgrade-only on cmdline."
+if [ -n "$opt_upgrade_only" -a ! -e "$MARKER" ]; then
+	echo "$0: doing nothing, XS is not active."
 	exit 0
 fi
 
@@ -54,6 +54,11 @@ source /usr/bin/xs-setup-functions
 
 # prep the XO
 do-first
+#yum-etckeeper yes
+#turn off the etckeeper to speed things up
+#yum-etckeeper no
+set-etckeeper no
+mlocate yes
 
 # Remote admin services 
 httpd yes
@@ -61,22 +66,15 @@ vnc yes
 
 # Core services offered
 ejabberd yes
-webdav yes
-xs-security yes
 idmgr yes
 postgresql yes
 moodle-xs yes
-
-# for normal use, choose either of the following (gateway turns on masquerade)
-squid yes
-gateway yes
-dhcpd yes
-named yes
+xs-security yes
+webdav yes
 
 # Finalize install
 yum-etckeeper yes
 do-last
-
 echo "XS configured; services are ready to use."
 #echo "please check the configured services below"
 #xs-services-check
diff --git a/scripts/xs-setup-functions b/scripts/xs-setup-functions
index dfdea7c..aecd1aa 100755
--- a/scripts/xs-setup-functions
+++ b/scripts/xs-setup-functions
@@ -24,62 +24,12 @@ DEFAULTUSER='admin'
 DEFAULTPASSWORD='12admin'
 ISXO=`[ -f /proc/device-tree/mfg-data/MN ] && echo 1 || echo 0`
 YUMERROR=10
-YUM_CMD="yum -y install"
-
-function check_installed()
-{
-    installed=`ls $SETUPSTATEDIR | grep $0`
-    if [ -f $installed ]; then
-	echo "$0 Already installed" | tee -a $LOG
-	exit 2
-    fi	
-}
-
-function template()
-{
-	case "$1" in
-    "yes")
-        yum -y install  xs-release 2>&1 | tee -a $LOG
-        if [ $? -ne 0 ] ; then
-            echo "\n\nYum returned an error\n\n" | tee -a $LOG
-            exit $YUMERROR
-        fi
-        touch SETUPSTATEDIR/xs-release
-        #execute the setup script
-        ;;
-    "no")
-        rm $SETUPSTATEDIR/xs-release
-        ;;
-    esac
-}
-
-function xs-acpowergaps()
-{
-	case "$1" in
-    "yes")
-        cat > /etc/sysconfig/olpc-scripts/acpowergaps.txt < EOF
-        */6 * * * * root /usr/bin/xs-acpowergaps-cron
-        EOF
-        crontab /etc/sysconfig/olpc-scripts/acpowergaps.txt
-        touch SETUPSTATEDIR/xs-acpowergaps
-        ;;
-    "no")
-        rm $SETUPSTATEDIR/xs-acpowergaps
-        ;;
-    esac
-}
 
 function activity-server()
 {
 	case "$1" in
     "yes")
-	if [ "$(check_installed)" -ne "2" ]; then
-	    $YUM_CMD xs-activity-server 2>&1 | tee -a $LOG
-            if [ $? -ne 0 ] ; then
-                echo "\n\nYum returned an error\n\n" | tee -a $LOG
-                exit $YUMERROR
-            fi
-	fi
+        yum -y install  xs-activity-server 2>&1 | tee -a $LOG
         touch SETUPSTATEDIR/activity-server
         #execute the setup script
         /etc/sysconfig/olpc-scripts/setup.d/xs-activity-server
@@ -94,18 +44,16 @@ function avahi()
 {
 	case "$1" in
 	"yes")
-	if [ "$(check_installed)" -ne "2" ]; then
-	    $YUM_CMD nss-mdns avahi avahi-tools avahi-ui 2>&1 | tee -a $LOG
-            if [ $? -ne 0 ] ; then
-                echo "\n\nYum returned an error\n\n" | tee -a $LOG
-                exit $YUMERROR
-	    fi
+        yum -y install nss-mdns avahi avahi-tools avahi-ui 2>&1 | tee -a $LOG
+        if [ $? -ne 0 ] ; then
+            echo "\n\nYum returned an error\n\n" | tee -a $LOG
+            exit $YUMERROR
         fi
-	systemctl enable avahi-daemon.service 2>&1 | tee -a $LOG
+		systemctl enable avahi-daemon.service 2>&1 | tee -a $LOG
         touch $SETUPSTATEDIR/avahi
         ;;
 	"no")
-	systemctl disable avahi-daemon.service 2>&1 | tee -a $LOG
+		systemctl disable avahi-daemon.service 2>&1 | tee -a $LOG
         rm $SETUPSTATEDIR/avahi
         ;;
 	esac
@@ -115,12 +63,10 @@ function dhcpd()
 {
 	case "$1" in
 	"yes")
-	if [ "$(check_installed)" -ne "2" ]; then
-	    $YUM_CMD dhcp 2>&1 | tee -a $LOG
-            if [ $? -ne 0 ] ; then
-                echo "\n\nYum returned an error\n\n" | tee -a $LOG
-                exit $YUMERROR
-            fi
+        yum -y install dhcp 2>&1 | tee -a $LOG
+        if [ $? -ne 0 ] ; then
+            echo "\n\nYum returned an error\n\n" | tee -a $LOG
+            exit $YUMERROR
         fi
 	systemctl enable dhcpd.service 2>&1 | tee -a $LOG
 	systemctl start dhcpd.service 2>&1 | tee -a $LOG
@@ -149,7 +95,14 @@ function set-etckeeper()
 	"yes")
         if [ ! -d /etc/.git ]; then
             pushd /etc
+#            yum -y install etckeeper
+#            if [ $? -ne 0 ] ; then
+#                echo "\n\nYum returned an error\n\n" | tee -a $LOG
+#                exit $YUMERROR
+#            fi
             etckeeper init
+#            etckeeper commit -m "Initial checkin"
+#            git gc
             popd
         fi
 
@@ -169,17 +122,15 @@ function ejabberd()
 {
 	case "$1" in
 	"yes")
-	        if [ "$(check_installed)" -ne "2" ]; then
-	            $YUM_CMD ejabberd 2>&1 | tee -a $LOG
-		    if [ $? -ne 0 ] ; then
-		        echo "\n\nYum returned an error\n\n" | tee -a $LOG
-		        exit $YUMERROR
-		    fi
+		yum -y install ejabberd 2>&1 | tee -a $LOG
+		if [ $? -ne 0 ] ; then
+		    echo "\n\nYum returned an error\n\n" | tee -a $LOG
+		    exit $YUMERROR
+		fi
 		# and set it to autostart
 		systemctl enable ejabberd-xs.service 2>&1 | tee -a $LOG
 		systemctl start ejabberd-xs.service 2>&1 | tee -a $LOG
 		touch $SETUPSTATEDIR/ejabberd
-                fi 
 		;;
 	"no")
 		systemctl disable ejabberd.service 2>&1 | tee -a $LOG
@@ -192,17 +143,23 @@ function gateway()
 {
 	case "$1" in
 	"yes")
-        cp /etc/sysconfig/olpc-scripts/iptables-xs.in /etc/sysconfig/olpc-scripts/iptables-xs
-        cp /etc/sysconfig/olpc-scripts/ip6tables-xs.in /etc/sysconfig/olpc-scripts/ip6tables-xs
-        cp /etc/sysconfig/olpc-scripts/firewall-xs.in /etc/sysconfig/olpc-scripts/firewall-xs
+	CFG_TEMPLATES="sysconfig/iptables-config sysconfig/ip6tables-config"
+
+	for i in $CFG_TEMPLATES; do
+	    cp -p $i.in $i
+	    # etckeeper commit -m "Made from $i.in"
+	done
 
         # either enable the service or create the file not both
-        ln -sf $CFGDIR/etc/systemd/system/iptables.service $DESTDIR/etc/systemd/system
-        #systemctl enable iptables.service
 
+        ln -sf $CFGDIR/etc/systemd/system/iptables.service $DESTDIR/etc/systemd/system
+#	/etc/sysconfig/iptables-config
+        systemctl enable iptables.service
+	systemctl enable ip6tables.service
         systemctl start iptables.service
+	systemctl start ip6tables.service
         # systemd has a check for exist /etc/sysconfig/iptables - so ensure that it exists
-        /etc/sysconfig/iptables-config
+        
         touch $SETUPSTATEDIR/gateway
         ;;
 	"no")
@@ -217,13 +174,11 @@ function httpd()
 {
 	case "$1" in
 	"yes")
-	if [ "$(check_installed)" -ne "2" ]; then
-	    $YUM_CMD httpd php  2>&1 | tee -a $LOG
-            if [ $? -ne 0 ] ; then
-                echo "\n\nYum returned an error\n\n" | tee -a $LOG
-                exit $YUMERROR
-            fi
-	fi
+		yum -y install httpd php  2>&1 | tee -a $LOG
+        if [ $? -ne 0 ] ; then
+            echo "\n\nYum returned an error\n\n" | tee -a $LOG
+            exit $YUMERROR
+        fi
         cp -p /etc/httpd/conf/httpd-xs.conf.in /etc/httpd/conf/httpd-xs.conf
 		# Choose a config depending on memory
 		MEMSIZE=$(grep '^MemTotal' /proc/meminfo | grep -oP '\d+')
@@ -261,15 +216,12 @@ function idmgr()
 {
 	case "$1" in
 	"yes")
-	if [ "$(check_installed)" -ne "2" ]; then
-	    $YUM_CMD idmgr ds-backup-server \
+        yum -y install idmgr ds-backup-server \
                 xs-rsync xinetd 2>&1 | tee -a $LOG
-            if [ $? -ne 0 ] ; then
-                echo "\n\nYum returned an error\n\n" | tee -a $LOG
-                exit $YUMERROR
-            fi
-	fi
-
+        if [ $? -ne 0 ] ; then
+            echo "\n\nYum returned an error\n\n" | tee -a $LOG
+            exit $YUMERROR
+        fi
 
         # set up the sqlite database for idmgr
         /etc/sysconfig/olpc-scripts/setup.d/idmgr
@@ -298,16 +250,51 @@ function idmgr()
 	esac
 }
 
+function mlocate()
+{
+	case "$1" in
+	"yes")
+        yum -y install mlocate 2>&1 | tee -a $LOG
+        if [ $? -ne 0 ] ; then
+            echo "\n\nYum returned an error\n\n" | tee -a $LOG
+            exit $YUMERROR
+        fi
+        updatedb
+        touch $SETUPSTATEDIR/mlocate
+        ;;
+	"no")
+        rm $SETUPSTATEDIR/mlocate
+        ;;
+	esac
+}
+
+function moodle()
+{
+	case "$1" in
+	"yes")
+        yum -y install moodle 2>&1 | tee -a $LOG
+        if [ $? -ne 0 ] ; then
+            echo "\n\nYum returned an error\n\n" | tee -a $LOG
+            exit $YUMERROR
+        fi
+		systemctl enable moddle.service 2>&1 | tee -a $LOG
+        touch $SETUPSTATEDIR/moodle
+        ;;
+	"no")
+		systemctl disable moddle.service 2>&1 | tee -a $LOG
+        rm $SETUPSTATEDIR/moodle
+        ;;
+	esac
+}
+
 function moodle-xs()
 {
 	case "$1" in
 	"yes")
-	if [ "$(check_installed)" -ne "2" ]; then
-	    $YUM_CMD moodle-xs 2>&1 | tee -a $LOG
-            if [ $? -ne 0 ] ; then
-                echo "\n\nYum returned an error\n\n" | tee -a $LOG
-                exit $YUMERROR
-            fi
+        yum -y install moodle-xs 2>&1 | tee -a $LOG
+        if [ $? -ne 0 ] ; then
+            echo "\n\nYum returned an error\n\n" | tee -a $LOG
+            exit $YUMERROR
         fi
 
 	# execute the moodle startup script
@@ -326,12 +313,10 @@ function named()
 {
 	case "$1" in
 	"yes")
-	if [ "$(check_installed)" -ne "2" ]; then
-	    $YUM_CMD bind bind-utils 2>&1 | tee -a $LOG
-            if [ $? -ne 0 ] ; then
-                echo "\n\nYum returned an error\n\n" | tee -a $LOG
-                exit $YUMERROR
-            fi
+        yum -y install bind bind-utils 2>&1 | tee -a $LOG
+        if [ $? -ne 0 ] ; then
+            echo "\n\nYum returned an error\n\n" | tee -a $LOG
+            exit $YUMERROR
         fi
         # if xs data files are installed before bind, named user doesn't exist,
         # and group ownership is set to root, which user named cannot read
@@ -346,7 +331,7 @@ function named()
 	"no")
 		systemctl disable named.service 2>&1 | tee -a $LOG
         # let the dhclinet control the name resolution normally
-	rm /etc/sysconfig/olpc-scripts/resolv.conf
+        rm /etc/sysconfig/olpc-scripts/resolv.conf
         rm $SETUPSTATEDIR/named
         ;;
 	esac
@@ -357,13 +342,11 @@ function pathagar()
 	case "$1" in
 	"yes")
         httpd yes
-	if [ "$(check_installed)" -ne "2" ]; then
-	    $YUM_CMD mod_python mod_wsgi  python-django Django \
+        yum -y mod_python mod_wsgi  python-django Django \
                 python-setuptools sqlite django-tagging
-            if [ $? -ne 0 ] ; then
-                echo "\n\nYum returned an error\n\n" | tee -a $LOG
-                exit $YUMERROR
-            fi
+        if [ $? -ne 0 ] ; then
+            echo "\n\nYum returned an error\n\n" | tee -a $LOG
+            exit $YUMERROR
         fi
         adduser bookserver
         cd /home/bookserver
@@ -390,13 +373,11 @@ function postgresql()
 {
 	case "$1" in
 	"yes")
-	if [ "$(check_installed)" -ne "2" ]; then
-	    $YUM_CMD postgresql postgresql-server 2>&1 | tee -a $LOG
-            if [ $? -ne 0 ] ; then
-                echo "\n\nYum returned an error\n\n" | tee -a $LOG
-                exit $YUMERROR
-            fi
-       	fi
+        yum -y install postgresql postgresql-server 2>&1 | tee -a $LOG
+        if [ $? -ne 0 ] ; then
+            echo "\n\nYum returned an error\n\n" | tee -a $LOG
+            exit $YUMERROR
+        fi
         cp -f $CFGDIR/etc/systemd/system/postgresql-xs.service \
             $DESTDIR/lib/systemd/system/
         # systemctl does not enable by linking a link, hence above cp
@@ -408,13 +389,9 @@ function postgresql()
             # postgresql-setup initdb need to move this edit upstream FIXME
             mkdir -p /library/pgsql-xs
             chown -R postgres:postgres /library/pgsql-xs/
-            sed -i -c "s/--auth='ident'\"/--auth='ident' --encoding='UTF8'\"/" \
+            sed -i -c "s/--auth='ident\"'/--auth='ident' --encoding='UTF8'\"/" \
                                     /usr/bin/postgresql-setup
 			/usr/bin/postgresql-setup  initdb postgresql-xs
-            sed -i -c 's/^#standard_conforming_string/standard_conformiong_strings = off/' \
-                        /library/pgsql-xs/postgresql.conf
-            sed -i -c 's/^#backslash_quote/backslash_quote = allow/' \
-                        /library/pgsql-xs/postgresql.conf
 		fi
 
 		# and set it to autostart
@@ -428,69 +405,15 @@ function postgresql()
 	esac
 }
 
-function sdcard()
-{
-	case "$1" in
-    "yes")
-        mountpoint = `df | gawk '/^\/dev\/mmcblk0p1 {print $7;}'`
-        echo "Contents of $mountpoint"
-        ls -l $mountpoint
-        echo -n "you are about to delete all this data. Is this ok? (y/N)"
-        read response
-        case $response in
-        #fall through
-        [yY] ) ;;
-        * ) exit 1
-            ;;
-        esac
-        umount /dev/mmcblk0p1
-        #delete all partitions on the drive
-        echo "d
-        1
-        d
-        2
-        d
-        3
-        d
-        4
-        w" | fdisk /dev/mmcblk0
-        fdisk -l /dev/mmcblk0 | gawk '
-        /^\/dev\/mmcblk0/ {start = $2; end = $3; blocks =  $4;}
-        /^Units/ {unit = $9;}
-        /^Disk \/dev/ { total_bytes = $5;}
-        # assume that the start is the errase block size
-        END {
-        if (start != 0) {
-            #assume that start is equal to erase block size
-            erase_block_size = start;
-            SWAP_MB = 512;
-            swap_size = SWAP_MB * 1024 * 1024;
-            swap_num_erase_blocks = int(swap_size / (erase_block_size * 512));
-            erase_blocks = int(end / start);
-            swap_begin = int(erase_blocks - swap_num_erase_blocks) * 8192;
-        } else {}
-            exit(1)
-        }'
-
-        touch SETUPSTATEDIR/sdcard
-        ;;
-    "no")
-        rm $SETUPSTATEDIR/sdcard
-        ;;
-    esac
-}
-
 function squid()
 {
 	case "$1" in
 	"yes")
-	if [ "$(check_installed)" -ne "2" ]; then
-	    $YUM_CMD squid 2>&1 | tee -a $LOG
-            if [ $? -ne 0 ] ; then
-                echo "\n\nYum returned an error\n\n" | tee -a $LOG
-                exit $YUMERROR
-            fi
-	fi
+        yum -y install squid 2>&1 | tee -a $LOG
+        if [ $? -ne 0 ] ; then
+            echo "\n\nYum returned an error\n\n" | tee -a $LOG
+            exit $YUMERROR
+        fi
         # create the cache directories
         squid -z
         ## Update flag for httpd cache
@@ -515,13 +438,11 @@ function vnc()
 {
 	case "$1" in
 	"yes")
-	if [ "$(check_installed)" -ne "2" ]; then
-	    $YUM_CMD tigervnc-server novnc 2>&1 | tee -a $LOG
-            if [ $? -ne 0 ] ; then
-                echo "\n\nYum returned an error\n\n" | tee -a $LOG
-                exit $YUMERROR
-            fi
-	fi
+        yum -y install tigervnc-server novnc 2>&1 | tee -a $LOG
+        if [ $? -ne 0 ] ; then
+            echo "\n\nYum returned an error\n\n" | tee -a $LOG
+            exit $YUMERROR
+        fi
         yum -y groupinstall XFCE  2>&1 | tee -a $LOG
         if [ $? -ne 0 ] ; then
             echo "\n\nYum returned an error\n\n" | tee -a $LOG
@@ -538,12 +459,10 @@ function vnc()
         ln -sf $DESTDIR/etc/systemd/system/vncserver\@.service \
             $DESTDIR/etc/systemd/system/multi-user.target.wants/vncserver\@\:1.service
         cp $CFGDIR/etc/sysconfig/vnc/xstartup /home/$DEFAULTUSER/.vnc/
+        chown -R $DEFAULTUSER:$DEFAULTUSER /home/$DEFAULTUSER/.vnc
         echo "$DEFAULTPASSWORD" | vncpasswd -f > \
                     /home/$DEFAULTUSER/.vnc/passwd
-        chown -R $DEFAULTUSER:$DEFAULTUSER /home/$DEFAULTUSER/.vnc
         chmod 600 /home/$DEFAULTUSER/.vnc/passwd
-        cp /etc/pki/CA/newcerts/admin/self.pem /home/admin
-        chown $DEFAULTUSER:$DEFAULTUSER /home/admin/self.pem
 		systemctl enable vncserver\@\:1.service 2>&1 | tee -a $LOG
         systemctl start vncserver\@\:1.service 2>&1 | tee -a $LOG
         systemctl start vncserverweb.service 2>&1 | tee -a $LOG
@@ -561,13 +480,11 @@ function webdav()
 	case "$1" in
 	"yes")
         cp /etc/httpd/conf.d/webdav.conf.in /etc/httpd/conf.d/webdav.conf
-	if [ "$(check_installed)" -ne "2" ]; then
-	    $YUM_CMD cadaver
-            if [ $? -ne 0 ] ; then
-                echo "\n\nYum returned an error\n\n" | tee -a $LOG
-                exit $YUMERROR
-            fi
-	fi
+        yum -y install cadaver
+        if [ $? -ne 0 ] ; then
+            echo "\n\nYum returned an error\n\n" | tee -a $LOG
+            exit $YUMERROR
+        fi
         mkdir -p /library/webdav
         chown apache:apache /library/webdav
         htpasswd -cb /etc/httpd/webdav.users.pwd $DEFAULTUSER $DEFAULTPASSWORD
@@ -600,13 +517,11 @@ function xs-security()
 {
 	case "$1" in
     "yes")
-	if [ "$(check_installed)" -ne "2" ]; then
-	    $YUM_CMD xs-tools olpc-bios-crypto bitfrost xs-activation 2>&1 | tee -a $LOG
-            if [ $? -ne 0 ] ; then
-                echo "\n\nYum returned an error\n\n" | tee -a $LOG
-                exit $YUMERROR
-            fi
-	fi
+        yum -y install  xs-tools olpc-bios-crypto bitfrost xs-activation 2>&1 | tee -a $LOG
+        if [ $? -ne 0 ] ; then
+            echo "\n\nYum returned an error\n\n" | tee -a $LOG
+            exit $YUMERROR
+        fi
         touch $SETUPSTATEDIR/xs-security
         ;;
     "no")
@@ -623,15 +538,12 @@ function do_first()
 	mv /home/olpc/yum.log /var/log/
     fi
 
-    # init etckeeper and turn it off
-    set-etckeeper yes
-    yum-etckeeper no
-    set-etckeeper no
-
     ## Prepare etckeeper database
     if [ ! -e $MARKER ]; then
         pushd /etc
-
+        set-etckeeper yes
+        yum-etckeeper no
+        
         ###
         ### CLEANUP XS 0.4 to XS 0.5
         ###
@@ -664,11 +576,8 @@ function do_first()
 	# keep yum cache
 	sed -i -c 's/keepcache=0/keepcache=1/' /etc/yum.conf
 	sed -i -c 's/metadata_expire=7d/metadata_expire=never/' /etc/yum.repos.d/fedora.repo
-#	sed -i '#gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$basearch# a\ exclude=ejabberd' /etc/yum.repos.d/fedora.repo
-#	sed -i '#gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$basearch# a\ exclude=ejabberd' /etc/yum.repos.d/fedora-updates.repo
-
-	# use NM keyfile in place of ifcfg-rh XOs have this set already via OOB
-	sed -i -e 's/ifcfg-rh/keyfile/' /etc/NetworkManager/NetworkManager.conf
+#        sed -i -c '#gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$basearch# a\ exclude=ejabberd' /etc/yum.repos.d/fedora.repo
+#        sed -i -c '#gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$basearch# a\ exclude=ejabberd' /etc/yum.repos.d/fedora-updates.repo
 
         ## Prepare config files
         CFG_TEMPLATES="rsyslog.conf motd.olpc sysctl.conf ssh/sshd_config
@@ -679,12 +588,12 @@ function do_first()
             cp -p $i.in $i
         done
 
-        # Load new sysctl.conf settings
-        sysctl -p
-
         #record the config file additions
         etckeeper-if-selected 'Config files copied <file.in> to <file>'
 
+        # Load new sysctl.conf settings
+        sysctl -p
+
         # Work would be needed to get the XS components playing nice with SELinux, so
         # disable it.
         if selinuxenabled; then
@@ -716,7 +625,7 @@ function do_first()
 	xs-setup-network
 
         # following packages are the core set of packages installed on all xs servers
-	$YUM_CMD syck rssh mtd-utils acpid mlocate 2>&1 | tee -a $LOG
+        yum -y install  syck rssh mtd-utils acpid  2>&1 | tee -a $LOG
         if [ $? -ne 0 ] ; then
             echo "\n\nYum returned an error\n\n" | tee -a $LOG
             exit $YUMERROR
@@ -734,7 +643,7 @@ function do_first()
         etckeeper-if-selected "after installing core packages"
 
         popd
-
+        
     fi
     echo "do first routine completed" | tee -a $LOG
     date  2>&1 | tee -a $LOG
diff --git a/scripts/xs-setup-network b/scripts/xs-setup-network
index df9d219..441d559 100755
--- a/scripts/xs-setup-network
+++ b/scripts/xs-setup-network
@@ -33,10 +33,13 @@ num_ifaces=`ls /sys/class/net | wc | gawk '{print $1}'`
 # Is this an XO
 is_xo=`[ -f /proc/device-tree/mfg-data/MN ] && echo 1 || echo 0`
 echo $is_xo
-CFG_TEMPLATES="sysconfig/dhcpd sysconfig/iptables-config sysconfig/ip6tables-config"
+
 CONFIG_LIST="/etc/hosts"
-UPLINK=`find /etc/NetworkManager/system-connections -maxdepth 1 -type f -name "*" -not -name static -not -name "Sugar *"`
 
+pushd /etc
+
+#========================================================
+# Prepare config files
 #new code to use NetworkManager to set up devices
 function write_nm_connection(){
     # receives connection_filename, hwaddr,  device_name as parameters
@@ -45,36 +48,34 @@ function write_nm_connection(){
     #removed -i to try to get rid of sed intermediate files 9/24/2012
     sed -i  "s/\@\@MAC\@\@/$2/" "/etc/NetworkManager/system-connections/$1"
     sed -i  "s/\@\@DEVICE\@\@/$3/" "/etc/NetworkManager/system-connections/$1"
+    etckeeper commit -m "Made network interface $@"
     chmod 600 "/etc/NetworkManager/system-connections/$1" 
 }
 
-#========================================================
 # all xo's have a wifi and a lo interface
 if [[ $is_xo = "1" ]]; then
     num_ifaces=$(( $num_ifaces - 1 ))
-    if [[ $num_ifaces  = 1 ]]; then
-        ipaddr=ifconfig eth0| awk -F ' *|:' '/inet addr/{print $4}'
-    fi
+    # if we have 2 ethernet dongles, lo, )
     if [[ $num_ifaces  > 1 ]]; then
         mac=`ifconfig | gawk 'BEGIN { eth="";} (/^.*: flags=/) {eth = $1;} 
             /^ *ether / { if (eth == "eth1:") print( $2);}'`
         write_nm_connection "static" "$mac" "eth1"
         ipaddr=172.18.96.1
     fi
-    # if we have 2 ethernet dongles, lo, )
+
     if [[ $num_ifaces = 3 ]] ; then
         mac=`ifconfig | gawk 'BEGIN { eth="";} (/^.*: flags=/) {eth = $1;} 
             /^ *ether / { if (eth == "eth2:") print( $2);}'`
         write_nm_connection "dhcp" "$mac" "eth2"
-        echo "eth2" > /etc/sysconfig/xs_wan_device
-    else
-        echo "eth0" > /etc/sysconfig/xs_wan_device
-	# based on observed created files
-        echo "ignore-auto-dns=true" >> $UPLINK
+	echo "eth2" > /etc/sysconfig/xs_wan_device
+    else 
+	echo "eth0" > /etc/sysconfig/xs_wan_device 	
+    fi
+
+    if [[ $num_ifaces  = 1 ]]; then
+        ipaddr=ifconfig eth0| awk -F ' *|:' '/inet addr/{print $4}'
+	etckeeper commit -m "Single network interface found"
     fi
-    cp /usr/share/xs-config/cfg/etc/NetworkManager/system-connections/"Sugar Modem Connection" \
-        /etc/NetworkManager/system-connections/
-    chmod 600 /etc/NetworkManager/system-connections/"Sugar Modem Connection"
 else
     mac=`ifconfig | gawk 'BEGIN { eth="";} (/^.*: flags=/) {eth = $1;} 
         /^ *ether / { if (eth == "eth0:") print( $2);}'`
@@ -82,28 +83,19 @@ else
     ipaddr=172.18.96.1
     mac=`ifconfig | gawk 'BEGIN { eth="";} (/^.*: flags=/) {eth = $1;} 
         /^ *ether / { if (eth == "eth1:") print( $2);}'`
-    write_nm_connection "dhcp" "$mac" "eth1"
-    echo "eth1" > /etc/sysconfig/xs_wan_device
+    write_nm_connection "dhcp" "$mac" "eth1"   
 fi
 
-pushd /etc
-for i in $CFG_TEMPLATES; do
-	cp -p $i.in $i
-	#etckeeper commit -m "Made from $i.in"
-done
-#etckeeper commit -m "Made from $i.in"
-popd
+etckeeper commit -m "xs-setup-network configured services"
 
-#etckeeper commit -m "xs-setup-network configured services"
+#  This is the suffix which original versions of modified files will have
+BACKUP_SUFFIX=old
 
 short_host=`hostname -s`
 new_name=`hostname -f`
 
 systemctl stop NetworkManager.service
 
-#  This is the suffix which original versions of modified files will have
-BACKUP_SUFFIX=old
-
 for config in $CONFIG_LIST;
 do
     if [ -e $config.in ]; then
@@ -121,10 +113,19 @@ do
     fi
 done
 
+etckeeper commit -m "set /etc/hosts to $ipaddr $new_name $short_host"
+echo "XS standard networking configured"
+popd
 systemctl start NetworkManager.service
 sleep 5
-systemctl enable iptables.service
-systemctl enable ip6tables.service
-systemctl start iptables.service
-systemctl start ip6tables.service
-echo "XS standard networking configured"
+
+if [[ $num_ifaces = 1 ]]; then 
+    exit 0
+fi
+
+source /usr/bin/xs-setup-functions
+dhcpd yes
+named yes
+squid yes
+gateway yes
+
diff --git a/scripts/xs-sleep b/scripts/xs-sleep
deleted file mode 100755
index cf5e5d5..0000000
--- a/scripts/xs-sleep
+++ /dev/null
@@ -1,410 +0,0 @@
-#!/usr/bin/python
-#program to control the sleep cycles of the XS
-try:
-    from gi.repository import Gtk, Gdk
-except:
-    import gtk as Gtk
-from time import localtime, strftime
-from datetime import date
-from subprocess import Popen, PIPE
-import datetime
-import os, sys
-import gconf
-import logging
-import json
-from gettext import gettext as _
-CONFIG_FILE = "/home/olpc/.sleepcfg"
-
-WORK_DIR = "/home/olpc"
-
-logger = logging.getLogger('serversleep')
-hdlr = logging.FileHandler(os.path.join(WORK_DIR,'getsource.log'))
-formatter = logging.Formatter('%(asctime)s %(levelname)s %(messages)s')
-hdlr.setFormatter(formatter)
-logger.addHandler(hdlr)
-logger.setLevel(logging.WARNING)
-
-#declare a global dictionary for config data
-cfg = {}
-builder = object()
-
-class SleepTools:
-    def parse_time(self, time_str):
-        #return a tupple of int (hr,min) given input of string "hh:mm" form
-        time_list = time_str.split(':')
-        try:
-            return (int(time_list[0]), int(time_list[1]))
-        except:
-            return (0,0)
-
-    def calc_sleep(self):
-        global cfg
-        #return the hours from sleepstart to sleepend, considering skiped school days
-        days = ["skipmon","skiptue","skipwed","skipthu","skipfri","skipsat","skipsun"]
-        hrs, mins = self.parse_time(cfg["sleepstart"] )
-        start = datetime.datetime.now()
-        start = datetime.datetime(start.year, start.month, start.day, hrs, mins)
-        cfg['sleepstartlong'] = self.tstamp(start)
-        hrs, mins = self.parse_time(cfg["sleepstop"] )
-        stop = datetime.datetime.now()
-        stop = datetime.datetime(stop.year, stop.month, stop.day, hrs, mins)
-        sleeptime = start- stop
-        if sleeptime  > datetime.timedelta(0):
-            sleeptime = datetime.timedelta(hours=24) - sleeptime
-        daynum = datetime.datetime.now().weekday()
-        for i in range (7):
-            daynum += 1
-            if daynum > 6:
-                daynum = 0
-            if not cfg[days[daynum]]:
-                break
-            sleeptime += datetime.timedelta(hours=24)
-
-        stop = start + sleeptime
-        cfg['sleepstoplong'] = self.tstamp(stop)
-        #dt = datetime.datetime.fromtimestamp(cfg['sleepstartlong'])
-        #print("begin sleeping at  %s. seconds since 1970:%s"% (dt.strftime("%d. %B %Y %I:%M%p"),
-         #                                                      cfg['sleepstartlong'],))
-        #dt = datetime.datetime.fromtimestamp(cfg['sleepstoplong'])
-        #print("and wake up at  %s. seconds since 1970:%s"% (dt.strftime("%d. %B %Y %I:%M%p"),
-         #                   cfg['sleepstoplong'],))
-        return sleeptime
-
-
-    def cli(self, cmd):
-        """send cmd line to shell, rtn (text,error code)"""
-        logger.debug('command_line cmd:%s'%cmd)
-        p1 = Popen(cmd,stdout=PIPE, shell=True)
-        output = p1.communicate()
-        if p1.returncode != 0 :
-            logger.debug('error returned from shell command: %s was %s'%(cmd,output[0]))
-        return output[0],p1.returncode
-
-    def tstamp(self, dtime):
-        '''return a UNIX style timestamp for datetime input'''
-        epoch = datetime.datetime(1970, 1, 1)
-        since_epoch_delta = dtime - epoch
-        return since_epoch_delta.total_seconds()
-
-class PowerInterface(SleepTools):
-    def __init__(self):
-        global cfg
-        global builder
-        #get the config file with previous selections
-        try:
-            fd = file(CONFIG_FILE,'r')
-        except IOError:
-            #this is first run of program, set up defaults
-            try:
-                fd = file(CONFIG_FILE,'w')
-                cfg = {
-                    "sleepenable" :False,
-                    "sleepstart"  :'17:00',
-                    "sleepstop"    :'6:00',
-                    "skipmon"     :False,
-                    "skiptue"     :False,
-                    "skipwed"     :False,
-                    "skipthu"     :False,
-                    "skipfri"     :False,
-                    "skipsat"     :True,
-                    "skipsun"     :True,
-                    "override"    :False,
-                    "sleepstoplong":0L,
-                    "sleepstartlong":0L
-                }
-                cfg_str = json.dumps(cfg)
-                print ("json:%s."%(cfg_str,))
-                fd.write(cfg_str)
-                fd.close()
-                fd = file(CONFIG_FILE,'r')
-            except IOError,e:
-                logging.exception("failed to write config str. error:%s"% (e,))
-                fd = file(CONFIG_FILE,'r')
-        cfg_str = fd.read()
-        cfg = json.loads(cfg_str)
-
-        #use Glade generated XML description of UI GTK widgets to create window
-        builder = Gtk.Builder()
-        builder.add_from_file("sleep.glade")
-        window = builder.get_object("window1")
-        window.show_all()
-        handlers = {
-            "onDeleteWindow": self.done,
-            "override_clicked_cb"   : self.override,
-            "enable_toggled_cb"     : self.enable_toggled,
-            "sleepbegin_changed_cb" : self.sleepstart_changed,
-            "sleepend_changed_cb"  : self.sleepstop_changed,
-            "mon1_toggled_cb"       : self.mon1_toggled,
-            "tue1_toggled_cb"       : self.tue1_toggled,
-            "wed1_toggled_cb"       : self.wed1_toggled,
-            "thu1_toggled_cb"       : self.thu1_toggled,
-            "fri1_toggled_cb"       : self.fri1_toggled,
-            "sat1_toggled_cb"       : self.sat1_toggled,
-            "sun1_toggled_cb"       : self.sun1_toggled,
-			"newtime_activate_cb"	: self.time_changed_cb,
-        }
-
-        builder.connect_signals(handlers)
-
-        #create hourlist for combo boxes
-        self.hrlist = []
-        for hr in range(23):
-            self.hrlist.append("%s:00"%hr)
-            #hrlist.append("%s:30"%hr)
-        time_model = Gtk.ListStore(str)
-        for tm in self.hrlist:
-            time_model.append([tm])
-
-        enable_checkbox = builder.get_object("sleepenable")
-        enable_checkbox.set_active(cfg["sleepenable"])
-
-        start_school = builder.get_object("sleepbegin")
-        start_school.set_model(time_model)
-        renderer = Gtk.CellRendererText()
-        start_school.pack_start(renderer, True)
-        start_school.add_attribute(renderer,"text",0)
-        start_school.set_active(self.getindex(self.hrlist, cfg['sleepstart']))
-
-        stop_school = builder.get_object("sleepend")
-        stop_school.set_model(time_model)
-        renderer = Gtk.CellRendererText()
-        stop_school.pack_start(renderer, True)
-        stop_school.add_attribute(renderer,"text",0)
-        stop_school.set_active(self.getindex(self.hrlist, cfg['sleepstop']))
-
-        mon1_check_box = builder.get_object("mon1")
-        mon1_check_box.set_active(cfg["skipmon"])
-
-        tue1_check_box = builder.get_object("tue1")
-        tue1_check_box.set_active(cfg["skiptue"])
-
-        wed1_check_box = builder.get_object("wed1")
-        wed1_check_box.set_active(cfg["skipwed"])
-
-        thu1_check_box = builder.get_object("thu1")
-        thu1_check_box.set_active(cfg["skipthu"])
-
-        fri1_check_box = builder.get_object("fri1")
-        fri1_check_box.set_active(cfg["skipfri"])
-
-        sat1_check_box = builder.get_object("sat1")
-        sat1_check_box.set_active(cfg["skipsat"])
-
-        sun1_check_box = builder.get_object("sun1")
-        sun1_check_box.set_active(cfg["skipsun"])
-
-        label = builder.get_object("currenttimezone")
-        client = gconf.client_get_default()
-        #timezone = client.get_string('/desktop/sugar/date/timezone')
-        timezone = os.environ.get('TZ', "UTC")
-        os.environ["TZ"] = timezone
-        label.set_text("TimeZone: %s  Current Time: %s"%\
-            (timezone, strftime("%H:%M",localtime())))
-
-    def getindex(self, lst, val):
-        #return index of val in list or -1 if not in list
-        try:
-            return(lst.index(val))
-        except ValueError:
-            return(-1)
-
-    def show_override_status(self):
-        over_button  = builder.get_object("override")
-        if not cfg["sleepenable"]:
-            over_button.set_label(_("Status: Server Sleep is disabled"))
-        elif cfg["override"]:
-            over_button.set_label(_("Status: Next sleep cycle disabled\015\012Click here to re-enable."))
-        else:
-            sleeptime = self.calc_sleep()
-            over_button.set_label(_("Status: Server will sleep at %s for %s hours.\015\012 Click here to disable one sleep cycle")%\
-            (cfg["sleepstart"], sleeptime.total_seconds() // 3600))
-
-
-    def enable_toggled(self, widget):
-        global cfg
-        cfg["sleepenable"] = widget.get_active()
-        if cfg["sleepenable"]:
-            cfg["override"] = False
-        self.save_cfg()
-        self.show_override_status()
-
-
-    def sleepstart_changed(self, widget):
-        global cfg
-        index = widget.get_active()
-        cfg["sleepstart"] = self.hrlist[index]
-        self.save_cfg()
-        self.show_override_status()
-
-    def sleepstop_changed(self, widget):
-        global cfg
-        index = widget.get_active()
-        cfg["sleepstop"] = self.hrlist[index]
-        self.save_cfg()
-        self.show_override_status()
-
-    def mon1_toggled(self, widget):
-        global cfg
-        cfg["skipmon"] = widget.get_active()
-        self.save_cfg()
-        if self.check_seven_days("skipmon", widget): return self.complain_seven_days()
-        self.show_override_status()
-
-    def tue1_toggled(self, widget):
-        global cfg
-        cfg["skiptue"] = widget.get_active()
-        self.save_cfg()
-        if self.check_seven_days("skipmon", widget): return self.complain_seven_days()
-        self.show_override_status()
-
-    def wed1_toggled(self, widget):
-        global cfg
-        cfg["skipwed"] = widget.get_active()
-        self.save_cfg()
-        if self.check_seven_days("skipmon", widget): return self.complain_seven_days()
-        self.show_override_status()
-
-    def thu1_toggled(self, widget):
-        global cfg
-        cfg["skipthu"] = widget.get_active()
-        self.save_cfg()
-        if self.check_seven_days("skipmon", widget): return self.complain_seven_days()
-        self.show_override_status()
-
-    def fri1_toggled(self, widget):
-        global cfg
-        cfg["skipfri"] = widget.get_active()
-        self.save_cfg()
-        if self.check_seven_days("skipmon", widget): return self.complain_seven_days()
-        self.show_override_status()
-
-    def sat1_toggled(self, widget):
-        global cfg
-        cfg["skipsat"] = widget.get_active()
-        self.save_cfg()
-        if self.check_seven_days("skipmon", widget): return self.complain_seven_days()
-        self.show_override_status()
-
-    def sun1_toggled(self, widget):
-        global cfg
-        cfg["skipsun"] = widget.get_active()
-        self.save_cfg()
-        if self.check_seven_days("skipmon", widget): return self.complain_seven_days()
-        self.show_override_status()
-
-    def time_changed_cb(self,widget):
-        label = builder.get_object("currenttimezone")
-        time = widget.get_text()
-        label.set_text(time)
-
-    def override(self, widget):
-        global cfg
-        if  not cfg["sleepenable"]:
-            #maybe I should popup an error explanation here
-            self.show_override_status()
-            return
-        cfg["override"] = not cfg["override"]
-        if cfg["override"]:
-            self.set_color(widget, Gdk.Color.red)
-        else:
-            self.set_color(widget, Gdk.Color.green)
-            #if currently in a sleep period, sleep now
-            if datetime.now() > datetime.fromtimestamp(cfg['sleepstartlong']) & \
-                datetime.now() < datetime.fromtimestamp(cfg['sleepstoplong']):
-                over_button.set_label(_("Status: Server will sleep withiin the next hour"))
-            self.save_cfg()
-        self.show_override_status()
-
-
-    def done(self, widget, data):
-        Gtk.main_quit()
-
-    def save_cfg(self):
-        global cfg
-        try:
-            fd = file(CONFIG_FILE,'w')
-            cfg_str = json.dumps(cfg)
-            fd.write(cfg_str)
-            fd.close()
-        except IOError,e:
-            logging.exception("failed to write config str. error:%s"% (e,))
-
-    def set_color(self, obj, color):
-        #make a gdk.color
-        #map = obj.get_colormap()
-        #color = map.alloc_color(Gdk.color_parse(color_str))
-        #parse, color = Gdk.Color.parse(color_str)
-        #copy the current style and replace the background
-        style = obj.get_style().copy()
-        style.bg[Gtk.StateType.NORMAL] = Gdk.Color.green
-        #obj.override_background_color(Gtk.StateFlags.NORMAL, Gdk.RGBA(1, 0, 0, 1))
-
-        #set the button's style to the one you created
-        obj.set_style(style)
-
-    def check_seven_days(self, day_str, widget):
-        #check to see if this is the seventh day, if so return true
-        days = ["skipmon","skiptue","skipwed","skipthu","skipfri","skipsat","skipsun"]
-        daynum = current_day = days.index(day_str)
-        disabled = 0
-        for i in range(7):
-            daynum += 1
-            if daynum > 6:
-                daynum = 0
-            if cfg[days[daynum]]:
-                disabled += 1
-            if daynum == current_day and disabled == 7:
-                widget.set_active(False)
-                cfg[day_str] = False
-                self.save_cfg()
-                return True
-        return False
-
-    def complain_seven_days(self):
-        over_button  = builder.get_object("override")
-        over_button.set_label(_("You cannot disable all days in the week"))
-
-
-class PowerAction(SleepTools):
-    def __init__(self):
-        #get the config file with previous selections
-        try:
-            fd = file(CONFIG_FILE,'r')
-            cfg_str = fd.read()
-        except Exception,e:
-            logger.exception("cron invocation failed to read cfg. e=%s"%e)
-            return
-        cfg = json.loads(cfg_str)
-
-        #is current time > sleepstart?
-        daynum = datetime.datetime.now().weekday()
-        hrs, mins = self.parse_time(cfg["sleepstart"] )
-        current  = datetime.datetime.now()
-        start = datetime.datetime(current.year, current.month, current.day, hrs, mins)
-        if current > cfg["sleepstartlong"]:
-            #are we in an override situation?
-            if cfg["override"]:
-                if current > cfg["sleepstoplong"]:
-                    # end of sleep period, turn off override
-                    cfg["override"] = False
-                return
-            # set stop/wakeup time
-            self.sleep()
-
-    def sleep():
-        sleeptime = cfg["sleepstoplong"] - datetime.datetime.now()
-        rtcstring = "rtcwake -s %s -m disk"%(sleeptime,)
-        p1 = Popen(rtcstring,stdout=PIPE, shell=True)
-
-if __name__ == "__main__":
-    # if interactive from command line, do gui
-    if len(sys.argv) == 1:
-        pi = PowerInterface()
-    elif len(sys.argv == 2):
-        # if coming from cron, the check for an action to do
-        if sys.argv[1] == '--timeout':
-            pa = PowerAction()
-        sys.exit(0)
-    # pop up the GUI
-    Gtk.main()
-    exit(0)
diff --git a/scripts/xs-sleep.glade b/scripts/xs-sleep.glade
deleted file mode 100644
index 123e0e1..0000000
--- a/scripts/xs-sleep.glade
+++ /dev/null
@@ -1,260 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<interface>
-  <requires lib="gtk+" version="2.20"/>
-  <!-- interface-naming-policy project-wide -->
-  <object class="GtkWindow" id="window1">
-    <property name="title" translatable="yes">Power Off Nights And Weekends</property>
-    <property name="window_position">center</property>
-    <signal name="delete-event" handler="onDeleteWindow" swapped="no"/>
-    <child>
-      <object class="GtkVBox" id="vbox1">
-        <property name="visible">True</property>
-        <child>
-          <object class="GtkButton" id="override">
-            <property name="label" translatable="yes">Disable Next Sleep Cycle</property>
-            <property name="height_request">100</property>
-            <property name="visible">True</property>
-            <property name="can_focus">True</property>
-            <property name="receives_default">True</property>
-            <property name="use_action_appearance">False</property>
-            <signal name="clicked" handler="override_clicked_cb" swapped="no"/>
-          </object>
-          <packing>
-            <property name="expand">False</property>
-            <property name="fill">False</property>
-            <property name="position">0</property>
-          </packing>
-        </child>
-        <child>
-          <object class="GtkCheckButton" id="sleepenable">
-            <property name="label" translatable="yes">Enable Server Sleep</property>
-            <property name="visible">True</property>
-            <property name="can_focus">True</property>
-            <property name="receives_default">False</property>
-            <property name="use_action_appearance">False</property>
-            <property name="xalign">1</property>
-            <property name="draw_indicator">True</property>
-            <signal name="toggled" handler="enable_toggled_cb" swapped="no"/>
-          </object>
-          <packing>
-            <property name="padding">20</property>
-            <property name="position">1</property>
-          </packing>
-        </child>
-        <child>
-          <object class="GtkHBox" id="hbox1">
-            <property name="visible">True</property>
-            <child>
-              <object class="GtkAccelLabel" id="accellabel1">
-                <property name="visible">True</property>
-                <property name="label" translatable="yes">Start of School Day</property>
-              </object>
-              <packing>
-                <property name="position">0</property>
-              </packing>
-            </child>
-            <child>
-              <object class="GtkComboBox" id="sleepend">
-                <property name="visible">True</property>
-                <signal name="changed" handler="sleepend_changed_cb" swapped="no"/>
-              </object>
-              <packing>
-                <property name="position">1</property>
-              </packing>
-            </child>
-          </object>
-          <packing>
-            <property name="position">2</property>
-          </packing>
-        </child>
-        <child>
-          <object class="GtkHBox" id="hbox2">
-            <property name="visible">True</property>
-            <child>
-              <object class="GtkLabel" id="label1">
-                <property name="visible">True</property>
-                <property name="label" translatable="yes">End of School Day</property>
-              </object>
-              <packing>
-                <property name="position">0</property>
-              </packing>
-            </child>
-            <child>
-              <object class="GtkComboBox" id="sleepbegin">
-                <property name="visible">True</property>
-                <signal name="changed" handler="sleepbegin_changed_cb" swapped="no"/>
-              </object>
-              <packing>
-                <property name="position">1</property>
-              </packing>
-            </child>
-          </object>
-          <packing>
-            <property name="position">3</property>
-          </packing>
-        </child>
-        <child>
-          <object class="GtkFrame" id="frame1">
-            <property name="visible">True</property>
-            <property name="label_xalign">0</property>
-            <property name="shadow_type">none</property>
-            <child>
-              <object class="GtkAlignment" id="alignment1">
-                <property name="visible">True</property>
-                <property name="left_padding">12</property>
-                <child>
-                  <object class="GtkHBox" id="hbox4">
-                    <property name="visible">True</property>
-                    <child>
-                      <object class="GtkCheckButton" id="mon1">
-                        <property name="label" translatable="yes">Mon</property>
-                        <property name="visible">True</property>
-                        <property name="can_focus">True</property>
-                        <property name="receives_default">False</property>
-                        <property name="use_action_appearance">False</property>
-                        <property name="draw_indicator">True</property>
-                        <signal name="toggled" handler="mon1_toggled_cb" swapped="no"/>
-                      </object>
-                      <packing>
-                        <property name="position">0</property>
-                      </packing>
-                    </child>
-                    <child>
-                      <object class="GtkCheckButton" id="tue1">
-                        <property name="label" translatable="yes">Tue</property>
-                        <property name="visible">True</property>
-                        <property name="can_focus">True</property>
-                        <property name="receives_default">False</property>
-                        <property name="use_action_appearance">False</property>
-                        <property name="draw_indicator">True</property>
-                        <signal name="toggled" handler="tue1_toggled_cb" swapped="no"/>
-                      </object>
-                      <packing>
-                        <property name="position">1</property>
-                      </packing>
-                    </child>
-                    <child>
-                      <object class="GtkCheckButton" id="wed1">
-                        <property name="label" translatable="yes">Wed</property>
-                        <property name="visible">True</property>
-                        <property name="can_focus">True</property>
-                        <property name="receives_default">False</property>
-                        <property name="use_action_appearance">False</property>
-                        <property name="draw_indicator">True</property>
-                        <signal name="toggled" handler="wed1_toggled_cb" swapped="no"/>
-                      </object>
-                      <packing>
-                        <property name="position">2</property>
-                      </packing>
-                    </child>
-                    <child>
-                      <object class="GtkCheckButton" id="thu1">
-                        <property name="label" translatable="yes">Thu</property>
-                        <property name="visible">True</property>
-                        <property name="can_focus">True</property>
-                        <property name="receives_default">False</property>
-                        <property name="use_action_appearance">False</property>
-                        <property name="draw_indicator">True</property>
-                        <signal name="toggled" handler="thu1_toggled_cb" swapped="no"/>
-                      </object>
-                      <packing>
-                        <property name="position">3</property>
-                      </packing>
-                    </child>
-                    <child>
-                      <object class="GtkCheckButton" id="fri1">
-                        <property name="label" translatable="yes">Fri</property>
-                        <property name="visible">True</property>
-                        <property name="can_focus">True</property>
-                        <property name="receives_default">False</property>
-                        <property name="use_action_appearance">False</property>
-                        <property name="draw_indicator">True</property>
-                        <signal name="toggled" handler="fri1_toggled_cb" swapped="no"/>
-                      </object>
-                      <packing>
-                        <property name="position">4</property>
-                      </packing>
-                    </child>
-                    <child>
-                      <object class="GtkCheckButton" id="sat1">
-                        <property name="label" translatable="yes">Sat</property>
-                        <property name="visible">True</property>
-                        <property name="can_focus">True</property>
-                        <property name="receives_default">False</property>
-                        <property name="use_action_appearance">False</property>
-                        <property name="draw_indicator">True</property>
-                      </object>
-                      <packing>
-                        <property name="position">5</property>
-                      </packing>
-                    </child>
-                    <child>
-                      <object class="GtkCheckButton" id="sun1">
-                        <property name="label" translatable="yes">Sun</property>
-                        <property name="visible">True</property>
-                        <property name="can_focus">True</property>
-                        <property name="receives_default">False</property>
-                        <property name="use_action_appearance">False</property>
-                        <property name="draw_indicator">True</property>
-                        <signal name="toggled" handler="sun1_toggled_cb" swapped="no"/>
-                      </object>
-                      <packing>
-                        <property name="position">6</property>
-                      </packing>
-                    </child>
-                  </object>
-                </child>
-              </object>
-            </child>
-            <child type="label">
-              <object class="GtkLabel" id="label2">
-                <property name="visible">True</property>
-                <property name="label" translatable="yes">&lt;b&gt;No School on:&lt;/b&gt;</property>
-                <property name="use_markup">True</property>
-              </object>
-            </child>
-          </object>
-          <packing>
-            <property name="position">4</property>
-          </packing>
-        </child>
-        <child>
-          <object class="GtkLabel" id="currenttimezone">
-            <property name="visible">True</property>
-            <property name="label" translatable="yes">Current Time Zone is:</property>
-          </object>
-          <packing>
-            <property name="position">5</property>
-          </packing>
-        </child>
-        <child>
-          <object class="GtkHBox" id="hbox3">
-            <property name="visible">True</property>
-            <child>
-              <object class="GtkLabel" id="label3">
-                <property name="visible">True</property>
-                <property name="label" translatable="yes">Change the Current Time</property>
-              </object>
-              <packing>
-                <property name="position">0</property>
-              </packing>
-            </child>
-            <child>
-              <object class="GtkEntry" id="newtime">
-                <property name="visible">True</property>
-                <property name="can_focus">True</property>
-                <property name="invisible_char">●</property>
-              </object>
-              <packing>
-                <property name="position">1</property>
-              </packing>
-            </child>
-          </object>
-          <packing>
-            <property name="position">8</property>
-          </packing>
-        </child>
-      </object>
-    </child>
-  </object>
-</interface>
diff --git a/xs-config.spec.in b/xs-config.spec.in
index 79b0a4c..57001fe 100644
--- a/xs-config.spec.in
+++ b/xs-config.spec.in
@@ -7,23 +7,23 @@ BuildArch: noarch
 #  a list of packages modified by xs-config
 Requires: python
 Requires: authconfig
-#Requires: bind
-Requires: initscripts
-Requires: iptables
-Requires: module-init-tools
-Requires: nscd
+#Requires: bind  
+Requires: initscripts  
+Requires: iptables  
+Requires: module-init-tools  
+Requires: nscd  
 Requires: nss
 Requires: ntp
-Requires: openssh-server
-Requires: radvd
-Requires: rpm
+Requires: openssh-server  
+Requires: radvd  
+Requires: rpm  
 Requires: selinux-policy
-Requires: setup
-Requires: smartmontools
-Requires: sudo
-Requires: syslog
+Requires: setup  
+Requires: smartmontools  
+Requires: sudo  
+Requires: syslog 
 Requires: logrotate
-Requires: xml-common
+Requires: xml-common  
 Requires: etckeeper
 Requires: make
 Requires: usbmount
@@ -46,8 +46,8 @@ Requires(post): coreutils
 
 Summary: XS/XSX default configuration
 Name: xs-config
-Version: @VERSION@
-Release: 1
+Version:  @VERSION@
+Release: 4
 BuildRoot: %{_builddir}/%{name}-root
 Distribution: OLPC XS/XSX School Server
 Group: Base System/Administration Tools
@@ -115,7 +115,6 @@ fi
 %config(noreplace) %{_sysconfdir}/ejabberd/ejabberd-xs.cfg.in
 %config(noreplace) %{_sysconfdir}/httpd/conf/httpd-xs.conf.in
 %config(noreplace) %{_sysconfdir}/httpd/conf.d/*.conf.in
-%config(noreplace) %{_sysconfdir}/sudoers.d/xs-http
 
 %config(noreplace) %{_sysconfdir}/sysconfig/olpc-scripts/
 %config(noreplace) %{_sysconfdir}/sysconfig/modules/*.modules
@@ -129,8 +128,8 @@ fi
 %config(noreplace) %{_sysconfdir}/ssh/sshd_config.in
 %config(noreplace) %{_sysconfdir}/sysconfig/*.in
 %config(noreplace) %{_sysconfdir}/sysconfig/ejabberd-xs
-%config %{_sysconfdir}/sysconfig/olpc-scripts/iptables-xs.in
-%config %{_sysconfdir}/sysconfig/olpc-scripts/ip6tables-xs.in
+%config %{_sysconfdir}/sysconfig/olpc-scripts/iptables.in
+%config %{_sysconfdir}/sysconfig/olpc-scripts/ip6tables.in
 %config %{_sysconfdir}/sysconfig/olpc-scripts/firewall-xs.in
 
 %attr(750, root , named)   %dir /var/named-xs
@@ -152,7 +151,6 @@ fi
 %{_libexecdir}/moodle-xs-init
 %doc README README.networking
 %doc README.no-fsck-questions
-%{_sysconfdir}/pki/CA/newcerts/admin/self.pem
 
 %files xo
 %{_bindir}/bootstrap-xo
